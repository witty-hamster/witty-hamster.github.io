<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"åŸºäº ELK + Filebeat æ­å»ºå¹¶å®ç°æ—¥å¿—é‡‡é›†æ¡†æ¶æ–¹æ¡ˆåŠæ—¥å¿—è„±æ•","image":["https://cdn.jsdelivr.net/gh/witty-hamster/oss@master/202511/image-20251114132831315.png","https://cdn.jsdelivr.net/gh/witty-hamster/oss@master/202511/image-20251114132831320.png"],"datePublished":"2025-11-14T00:00:00.000Z","dateModified":"2025-11-14T05:41:26.000Z","author":[{"@type":"Person","name":"Hamster","url":"https://witty-hamster.github.io"}]}</script><meta property="og:url" content="https://witty-hamster.github.io/posts/%E6%94%B6%E9%9B%86%E7%AE%B1/%E5%9F%BA%E4%BA%8E%20ELK%20_%20Filebeat%20%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E6%96%B9%E6%A1%88.html"><meta property="og:title" content="åŸºäº ELK + Filebeat æ­å»ºå¹¶å®ç°æ—¥å¿—é‡‡é›†æ¡†æ¶æ–¹æ¡ˆåŠæ—¥å¿—è„±æ•"><meta property="og:description" content="ğŸ”” ELK + Filebeat åŠŸèƒ½è¯¦è§£ ğŸ’¡ ELKï¼ˆElasticsearch + Logstash + Kibanaï¼‰ã€Filebeat æ˜¯ æ—¥å¿—æ”¶é›†ã€å¤„ç†ã€å­˜å‚¨ä¸å¯è§†åŒ– çš„ç»å…¸æŠ€æœ¯æ ˆï¼Œå¹¿æ³›ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§å»ºè®¾ ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ âœ… ç°ä»£å®è·µä¸­ï¼ŒFilebeat å¯ç›´æ¥å†™å…¥ Elasticsearchï¼Œç»•è¿‡ Logstashï¼ˆæ€§èƒ½æ›´é«˜..."><meta property="og:type" content="article"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/witty-hamster/oss@master/202511/image-20251114132831315.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-11-14T05:41:26.000Z"><meta property="article:tag" content="Filebeat"><meta property="article:tag" content="ELK"><meta property="article:published_time" content="2025-11-14T00:00:00.000Z"><meta property="article:modified_time" content="2025-11-14T05:41:26.000Z"><title>åŸºäº ELK + Filebeat æ­å»ºå¹¶å®ç°æ—¥å¿—é‡‡é›†æ¡†æ¶æ–¹æ¡ˆåŠæ—¥å¿—è„±æ•</title><meta name="description" content="ğŸ”” ELK + Filebeat åŠŸèƒ½è¯¦è§£ ğŸ’¡ ELKï¼ˆElasticsearch + Logstash + Kibanaï¼‰ã€Filebeat æ˜¯ æ—¥å¿—æ”¶é›†ã€å¤„ç†ã€å­˜å‚¨ä¸å¯è§†åŒ– çš„ç»å…¸æŠ€æœ¯æ ˆï¼Œå¹¿æ³›ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§å»ºè®¾ ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ âœ… ç°ä»£å®è·µä¸­ï¼ŒFilebeat å¯ç›´æ¥å†™å…¥ Elasticsearchï¼Œç»•è¿‡ Logstashï¼ˆæ€§èƒ½æ›´é«˜...">
    <link rel="preload" href="/assets/style-BufAwt8K.css" as="style"><link rel="stylesheet" href="/assets/style-BufAwt8K.css">
    <link rel="modulepreload" href="/assets/app-DagONn1s.js"><link rel="modulepreload" href="/assets/åŸºäº ELK _ Filebeat å®ç°æ—¥å¿—é‡‡é›†æ–¹æ¡ˆ.html-CZYEj8nu.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-DOGnbeAk.js" as="script"><link rel="prefetch" href="/assets/intro.html-CU9pBoiO.js" as="script"><link rel="prefetch" href="/assets/index.html-wLDVIumc.js" as="script"><link rel="prefetch" href="/assets/å°æŠ€å·§.html-P67TtCW8.js" as="script"><link rel="prefetch" href="/assets/å¦‚ä½•å°†åŒä¸€ä»½ä»£ç åˆ†åˆ«æ¨é€åˆ° githubå’Œ gitee ä¸Š.html-seWDW0m-.js" as="script"><link rel="prefetch" href="/assets/CompletableFuture ç±»è¯¦è§£.html-DS2umQOw.js" as="script"><link rel="prefetch" href="/assets/Redisè¸©å‘è®°å½•.html-fIqvyhaV.js" as="script"><link rel="prefetch" href="/assets/spring-cloud-gatewayæºç è°ƒè¯•ç¯å¢ƒæ­å»º.html-CYRpiHTy.js" as="script"><link rel="prefetch" href="/assets/404.html-BA_6ST5e.js" as="script"><link rel="prefetch" href="/assets/index.html-CKRtouvE.js" as="script"><link rel="prefetch" href="/assets/index.html-B3iOn22H.js" as="script"><link rel="prefetch" href="/assets/index.html-A6-FQYIf.js" as="script"><link rel="prefetch" href="/assets/index.html-D3EbCMS7.js" as="script"><link rel="prefetch" href="/assets/index.html-B6TFn4qJ.js" as="script"><link rel="prefetch" href="/assets/index.html-CL5THfF-.js" as="script"><link rel="prefetch" href="/assets/index.html-NUbmTA5B.js" as="script"><link rel="prefetch" href="/assets/index.html-Bwbw3cFO.js" as="script"><link rel="prefetch" href="/assets/index.html-CstVfKcZ.js" as="script"><link rel="prefetch" href="/assets/index.html-DHBee1tW.js" as="script"><link rel="prefetch" href="/assets/index.html-9h2guVK-.js" as="script"><link rel="prefetch" href="/assets/index.html-D2Z6HzuB.js" as="script"><link rel="prefetch" href="/assets/index.html-BY6uLta5.js" as="script"><link rel="prefetch" href="/assets/index.html-DjsJzQ8e.js" as="script"><link rel="prefetch" href="/assets/index.html-_kSQuUn0.js" as="script"><link rel="prefetch" href="/assets/index.html-viQFC1G-.js" as="script"><link rel="prefetch" href="/assets/index.html-CDla6pVH.js" as="script"><link rel="prefetch" href="/assets/index.html-CmzKgqfs.js" as="script"><link rel="prefetch" href="/assets/index.html-QoZsAxa_.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-CKV1Bsxh.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/logo.png" alt><!----><!----></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:house" sizing="height" height="1em"></iconify-icon><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="æ–‡ç« "><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:book" sizing="height" height="1em"></iconify-icon><!--]-->æ–‡ç« <!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="åšæ–‡"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:pen-to-square" sizing="height" height="1em"></iconify-icon>åšæ–‡<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ”¶é›†ç®±</h4><ul class="vp-dropdown-subitems"></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">git</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/git%E6%8C%87%E5%8D%97/%E5%A6%82%E4%BD%95%E5%B0%86%E5%90%8C%E4%B8%80%E4%BB%BD%E4%BB%A3%E7%A0%81%E5%88%86%E5%88%AB%E6%8E%A8%E9%80%81%E5%88%B0%20github%E5%92%8C%20gitee%20%E4%B8%8A.html" aria-label="åŒä¸€ä»½ä»£ç æ¨é€åˆ°ä¸¤ä¸ªè¿œç¨‹"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:pen-to-square" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->åŒä¸€ä»½ä»£ç æ¨é€åˆ°ä¸¤ä¸ªè¿œç¨‹<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/%E5%B0%8F%E6%8A%80%E5%B7%A7.html" aria-label="å°æŠ€å·§"><!--[--><iconify-icon class="vp-icon" icon="hugeicons:idea-01" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->å°æŠ€å·§<!----></a></li></ul></button></div></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/" aria-label="ä¸»é¡µ"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:house" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->ä¸»é¡µ<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable active"><iconify-icon class="vp-icon" icon="fa6-solid:book" sizing="both" width="1em" height="1em"></iconify-icon><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/posts/" aria-label="æ–‡ç« "><!---->æ–‡ç« <!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E5%B0%8F%E6%8A%80%E5%B7%A7.html" aria-label="å°æŠ€å·§"><!--[--><iconify-icon class="vp-icon" icon="hugeicons:idea-01" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->å°æŠ€å·§<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">GitæŒ‡å—</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">æ”¶é›†ç®±</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%94%B6%E9%9B%86%E7%AE%B1/Redis%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95.html" aria-label="Redisè¸©å‘è®°å½•"><!--[--><iconify-icon class="vp-icon" icon="cil:dog" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Redisè¸©å‘è®°å½•<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%94%B6%E9%9B%86%E7%AE%B1/spring-cloud-gateway%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" aria-label="Spring Cloud Gateway æºç è°ƒè¯•ç¯å¢ƒæ­å»º"><!--[--><iconify-icon class="vp-icon" icon="cil:dog" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Spring Cloud Gateway æºç è°ƒè¯•ç¯å¢ƒæ­å»º<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/%E6%94%B6%E9%9B%86%E7%AE%B1/%E5%9F%BA%E4%BA%8E%20ELK%20_%20Filebeat%20%E5%AE%9E%E7%8E%B0%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E6%96%B9%E6%A1%88.html" aria-label="åŸºäº ELK + Filebeat æ­å»ºå¹¶å®ç°æ—¥å¿—é‡‡é›†æ¡†æ¶æ–¹æ¡ˆåŠæ—¥å¿—è„±æ•"><!--[--><iconify-icon class="vp-icon" icon="noto-v1:hatching-chick" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->åŸºäº ELK + Filebeat æ­å»ºå¹¶å®ç°æ—¥å¿—é‡‡é›†æ¡†æ¶æ–¹æ¡ˆåŠæ—¥å¿—è„±æ•<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/%E6%94%B6%E9%9B%86%E7%AE%B1/CompletableFuture%20%E7%B1%BB%E8%AF%A6%E8%A7%A3.html" aria-label="Java8 - CompletableFuture å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒå·¥å…·ç±»è¯¦è§£"><!--[--><iconify-icon class="vp-icon" icon="devicon:java-wordmark" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->Java8 - CompletableFuture å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒå·¥å…·ç±»è¯¦è§£<!----></a></li></ul></section></li></ul></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/intro.html" aria-label="ä»‹ç»é¡µ"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:circle-info" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->ä»‹ç»é¡µ<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="vp-icon" icon="noto-v1:hatching-chick" sizing="height" height="1em"></iconify-icon>åŸºäº ELK + Filebeat æ­å»ºå¹¶å®ç°æ—¥å¿—é‡‡é›†æ¡†æ¶æ–¹æ¡ˆåŠæ—¥å¿—è„±æ•</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://witty-hamster.github.io" target="_blank" rel="noopener noreferrer">Hamster</a></span><span property="author" content="Hamster"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2025/11/14</span><meta property="datePublished" content="2025-11-14T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 23 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT23M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color5 clickable" role="navigation">æ”¶é›†ç®±</span><!--]--><meta property="articleSection" content="æ”¶é›†ç®±"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">ELK</span><span class="page-tag-item color3 clickable" role="navigation">Filebeat</span><!--]--><meta property="keywords" content="ELK,Filebeat"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h2 id="ğŸ””-elk-filebeat-åŠŸèƒ½è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#ğŸ””-elk-filebeat-åŠŸèƒ½è¯¦è§£"><span>ğŸ”” ELK + Filebeat åŠŸèƒ½è¯¦è§£</span></a></h2><blockquote><p>ğŸ’¡ <strong>ELKï¼ˆElasticsearch + Logstash + Kibanaï¼‰ã€Filebeat</strong> æ˜¯ <strong>æ—¥å¿—æ”¶é›†ã€å¤„ç†ã€å­˜å‚¨ä¸å¯è§†åŒ–</strong> çš„ç»å…¸æŠ€æœ¯æ ˆï¼Œå¹¿æ³›ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§å»ºè®¾</p></blockquote><h3 id="ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ"><span>ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-text"><span class="line"><span>[åº”ç”¨ç³»ç»Ÿ]</span></span>
<span class="line"><span>     â†“ (è¾“å‡ºæ—¥å¿—)</span></span>
<span class="line"><span>[Filebeat] â†’ [Logstash] â†’ [Elasticsearch] â†’ [Kibana]</span></span>
<span class="line"><span>     â†‘           â†‘</span></span>
<span class="line"><span>   è½»é‡é‡‡é›†    è¿‡æ»¤/è§£æ/ä¸°å¯Œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âœ… ç°ä»£å®è·µä¸­ï¼Œ<strong>Filebeat å¯ç›´æ¥å†™å…¥ Elasticsearch</strong>ï¼Œç»•è¿‡ Logstashï¼ˆæ€§èƒ½æ›´é«˜ï¼‰</p></blockquote><h3 id="äºŒã€å„ç»„ä»¶ä½œç”¨ä¸ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#äºŒã€å„ç»„ä»¶ä½œç”¨ä¸ç‰¹ç‚¹"><span>äºŒã€å„ç»„ä»¶ä½œç”¨ä¸ç‰¹ç‚¹</span></a></h3><h4 id="_1-filebeat-â€”â€”-è½»é‡çº§æ—¥å¿—é‡‡é›†å™¨-shipper" tabindex="-1"><a class="header-anchor" href="#_1-filebeat-â€”â€”-è½»é‡çº§æ—¥å¿—é‡‡é›†å™¨-shipper"><span>1. <strong>Filebeat</strong> â€”â€” è½»é‡çº§æ—¥å¿—é‡‡é›†å™¨ï¼ˆShipperï¼‰</span></a></h4><p>ğŸ“Œ <strong>ä½œç”¨ï¼š</strong></p><ul><li><strong>éƒ¨ç½²åœ¨ä¸šåŠ¡æœåŠ¡å™¨ä¸Š</strong>ï¼Œå®æ—¶ç›‘æ§æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚ <code>/var/log/app.log</code>ï¼‰</li><li>å°†æ–°å¢æ—¥å¿—<strong>å¢é‡é‡‡é›†</strong>å¹¶å‘é€åˆ°ä¸‹æ¸¸ï¼ˆLogstash æˆ– Elasticsearchï¼‰</li><li>æ”¯æŒå¤šè¡Œæ—¥å¿—ï¼ˆå¦‚ Java å¼‚å¸¸å †æ ˆï¼‰ã€æ—¥å¿—è½®è½¬ã€æ–­ç‚¹ç»­ä¼ </li></ul><p>âœ… <strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>è½»é‡ä½å¼€é”€</strong></td><td>åŸºäº Go ç¼–å†™ï¼Œå†…å­˜å ç”¨å°ï¼ˆé€šå¸¸ &lt; 50MBï¼‰ï¼Œé€‚åˆæ¯å°æœåŠ¡å™¨éƒ¨ç½²</td></tr><tr><td><strong>å¯é ä¼ è¾“</strong></td><td>ACK æœºåˆ¶ + æœ¬åœ°æ³¨å†Œè¡¨ï¼ˆregistryï¼‰è®°å½•è¯»å–ä½ç½®ï¼Œé¿å…ä¸¢æ—¥å¿—</td></tr><tr><td><strong>æ¨¡å—åŒ–æ”¯æŒ</strong></td><td>å†…ç½® <code>nginx</code>ã€<code>mysql</code>ã€<code>system</code> ç­‰æ¨¡å—ï¼Œè‡ªåŠ¨è§£æå¸¸è§æ—¥å¿—æ ¼å¼</td></tr><tr><td><strong>è¾“å‡ºçµæ´»</strong></td><td>å¯å‘å¾€ Logstashã€Elasticsearchã€Kafkaã€Redis ç­‰</td></tr><tr><td><strong>ä¸å¤„ç†æ—¥å¿—å†…å®¹</strong></td><td>é»˜è®¤åªåšâ€œæ¬è¿â€ï¼Œä¸åšè§£æï¼ˆé™¤éå¯ç”¨ processorsï¼‰</td></tr></tbody></table><p>âš™ï¸ <strong>ç¤ºä¾‹é…ç½®ï¼ˆé‡‡é›† JSON æ—¥å¿—ï¼‰ï¼š</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">filebeat.inputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¾“å…¥æµç¨‹é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">filestream</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # é‡‡é›†ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  paths</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:      </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é‡‡é›†æ—¥å¿—çš„è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/app/logs/*.log</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  json.keys_under_root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # å°† JSON å­—æ®µæå‡åˆ°é¡¶å±‚</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  json.overwrite_keys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">output.elasticsearch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¾“å‡ºæµç¨‹é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://es-cluster:9200&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å°†é‡‡é›†çš„æ—¥å¿—ç›´æ¥è¾“å‡ºåˆ° ES é›†ç¾¤</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="_2-logstash-â€”â€”-æ—¥å¿—å¤„ç†ç®¡é“-processor" tabindex="-1"><a class="header-anchor" href="#_2-logstash-â€”â€”-æ—¥å¿—å¤„ç†ç®¡é“-processor"><span>2. <strong>Logstash</strong> â€”â€” æ—¥å¿—å¤„ç†ç®¡é“ï¼ˆProcessorï¼‰</span></a></h4><p>ğŸ“Œ <strong>ä½œç”¨ï¼š</strong></p><ul><li>æ¥æ”¶æ¥è‡ª Filebeat/Kafka ç­‰çš„æ—¥å¿—</li><li><strong>è§£æã€è¿‡æ»¤ã€è½¬æ¢ã€ä¸°å¯Œ</strong>æ—¥å¿—å†…å®¹ï¼ˆå¦‚æå–å­—æ®µã€è„±æ•ã€æ·»åŠ æ ‡ç­¾ï¼‰</li><li>è¾“å‡ºåˆ° Elasticsearch æˆ–å…¶ä»–å­˜å‚¨</li></ul><p>âœ… <strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å¼ºå¤§å¤„ç†èƒ½åŠ›</strong></td><td>æ”¯æŒ Grokï¼ˆæ­£åˆ™è§£æï¼‰ã€JSON è§£æã€GeoIPã€æ—¥æœŸè½¬æ¢ç­‰</td></tr><tr><td><strong>æ’ä»¶ç”Ÿæ€ä¸°å¯Œ</strong></td><td>è¾“å…¥ï¼ˆinputï¼‰ã€è¿‡æ»¤ï¼ˆfilterï¼‰ã€è¾“å‡ºï¼ˆoutputï¼‰å‡æœ‰å¤§é‡æ’ä»¶</td></tr><tr><td><strong>æ”¯æŒè„±æ•</strong></td><td>å¯é€šè¿‡ <code>mutate</code> + <code>gsub</code> æˆ–è‡ªå®šä¹‰ Ruby è„šæœ¬å®ç°ç®€å•è„±æ•</td></tr><tr><td><strong>èµ„æºæ¶ˆè€—é«˜</strong></td><td>åŸºäº JVMï¼Œå†…å­˜/CPU å¼€é”€å¤§ï¼Œä¸é€‚åˆéƒ¨ç½²åœ¨ä¸šåŠ¡æœåŠ¡å™¨</td></tr><tr><td><strong>å¯é€‰ç»„ä»¶</strong></td><td>è‹¥æ—¥å¿—å·²æ˜¯ç»“æ„åŒ– JSONï¼Œå¯è·³è¿‡ Logstashï¼Œç”± Filebeat ç›´è¿ ES</td></tr></tbody></table><p>âš™ï¸ <strong>ç¤ºä¾‹ï¼šè„±æ•æ‰‹æœºå·ï¼ˆç®€å•åœºæ™¯ï¼‰</strong></p><div class="language-ruby line-numbers-mode" data-highlighter="shiki" data-ext="ruby" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-ruby"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">filter {    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é…ç½®è¿‡æ»¤å™¨</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  mutate {</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    gsub</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =&gt; [</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      &quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;(1[3-9]</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{9})&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;138****1234&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âš ï¸ æ³¨æ„ï¼šLogstash <strong>ä¸é€‚åˆå¤æ‚åµŒå¥— JSON è„±æ•</strong>ï¼ˆå¦‚å­—æ®µåä¸ç»Ÿä¸€ã€å±‚çº§ä¸ç¡®å®šï¼‰</p></blockquote><hr><h4 id="_3-elasticsearch-â€”â€”-åˆ†å¸ƒå¼æœç´¢ä¸å­˜å‚¨å¼•æ“" tabindex="-1"><a class="header-anchor" href="#_3-elasticsearch-â€”â€”-åˆ†å¸ƒå¼æœç´¢ä¸å­˜å‚¨å¼•æ“"><span>3. <strong>Elasticsearch</strong> â€”â€” åˆ†å¸ƒå¼æœç´¢ä¸å­˜å‚¨å¼•æ“</span></a></h4><p>ğŸ“Œ <strong>ä½œç”¨ï¼š</strong></p><ul><li>å­˜å‚¨æ—¥å¿—æ•°æ®ï¼ˆæ–‡æ¡£å‹ï¼ŒJSON æ ¼å¼ï¼‰</li><li>æä¾›<strong>å…¨æ–‡æ£€ç´¢ã€èšåˆåˆ†æã€é«˜æ€§èƒ½æŸ¥è¯¢</strong></li><li>æ”¯æŒæ°´å¹³æ‰©å±•ã€é«˜å¯ç”¨</li></ul><p>âœ… <strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p><ul><li>å€’æ’ç´¢å¼• + åˆ—å­˜ï¼ˆDoc Valuesï¼‰â†’ å¿«é€ŸæŸ¥è¯¢</li><li>è‡ªåŠ¨åˆ†ç‰‡ï¼ˆShardï¼‰ä¸å‰¯æœ¬ï¼ˆReplicaï¼‰</li><li>æ”¯æŒ Index Lifecycle Managementï¼ˆILMï¼‰è‡ªåŠ¨ç®¡ç†æ—¥å¿—ç”Ÿå‘½å‘¨æœŸ</li></ul><hr><h4 id="_4-kibana-â€”â€”-å¯è§†åŒ–ä¸æ“ä½œç•Œé¢" tabindex="-1"><a class="header-anchor" href="#_4-kibana-â€”â€”-å¯è§†åŒ–ä¸æ“ä½œç•Œé¢"><span>4. <strong>Kibana</strong> â€”â€” å¯è§†åŒ–ä¸æ“ä½œç•Œé¢</span></a></h4><p>ğŸ“Œ <strong>ä½œç”¨ï¼š</strong></p><ul><li>æŸ¥è¯¢ã€ç­›é€‰ã€å¯è§†åŒ–æ—¥å¿—ï¼ˆDiscoverã€Dashboardï¼‰</li><li>åˆ›å»ºå‘Šè­¦ï¼ˆAlertingï¼‰</li><li>ç®¡ç† Elasticsearch é›†ç¾¤ï¼ˆDev Toolsã€Index Patternsï¼‰</li></ul><p>âœ… <strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p><ul><li>æ‰€è§å³æ‰€å¾—çš„æŸ¥è¯¢ä½“éªŒï¼ˆKQL / Lucene è¯­æ³•ï¼‰</li><li>æ”¯æŒå›¾è¡¨ã€è¡¨æ ¼ã€åœ°å›¾ç­‰å¯è§†åŒ–</li><li>å¯é›†æˆ Machine Learning å¼‚å¸¸æ£€æµ‹</li></ul><hr><h3 id="ä¸‰ã€elk-filebeat-åœ¨ä½ çš„è„±æ•éœ€æ±‚ä¸­çš„é€‚ç”¨æ€§åˆ†æ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€elk-filebeat-åœ¨ä½ çš„è„±æ•éœ€æ±‚ä¸­çš„é€‚ç”¨æ€§åˆ†æ"><span>ä¸‰ã€ELK + Filebeat åœ¨ä½ çš„è„±æ•éœ€æ±‚ä¸­çš„é€‚ç”¨æ€§åˆ†æ</span></a></h3><h4 id="â“-èƒ½å¦ç”¨-elk-å®ç°-æ—¥å¿—è„±æ•å±•ç¤º" tabindex="-1"><a class="header-anchor" href="#â“-èƒ½å¦ç”¨-elk-å®ç°-æ—¥å¿—è„±æ•å±•ç¤º"><span>â“ èƒ½å¦ç”¨ ELK å®ç°â€œæ—¥å¿—è„±æ•å±•ç¤ºâ€ï¼Ÿ</span></a></h4><table><thead><tr><th>æ–¹æ¡ˆ</th><th>å¯è¡Œæ€§</th><th>é—®é¢˜</th></tr></thead><tbody><tr><td><strong>åœ¨ Logstash ä¸­è„±æ•</strong></td><td>âš ï¸ éƒ¨åˆ†å¯è¡Œ</td><td>- æ— æ³•å¤„ç†â€œå­—æ®µåä¸ç»Ÿä¸€â€ï¼ˆå¦‚ phone/mobileï¼‰<br>- æ— æ³•é€’å½’éå†åµŒå¥— JSON <br>- è„±æ•è§„åˆ™ç¡¬ç¼–ç ï¼Œéš¾ç»´æŠ¤</td></tr><tr><td><strong>åœ¨ Elasticsearch Ingest Pipeline è„±æ•</strong></td><td>âš ï¸ æœ‰é™æ”¯æŒ</td><td>- å¯ç”¨ Painless è„šæœ¬ï¼Œä½†æ€§èƒ½å·®ã€è°ƒè¯•éš¾ <br>- åŒæ ·éš¾å¤„ç†åŠ¨æ€å­—æ®µ</td></tr><tr><td><strong>åœ¨ Kibana å±•ç¤ºå±‚è„±æ•</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>Kibana æ— è„±æ•èƒ½åŠ›ï¼Œç›´æ¥å±•ç¤ºåŸå§‹æ•°æ®</td></tr><tr><td><strong>åŸå§‹æ—¥å¿—æ˜æ–‡å­˜ ESï¼Œåº”ç”¨å±‚è„±æ•</strong></td><td>âœ… <strong>æ¨è</strong></td><td>- ä¿æŒåŸå§‹æ—¥å¿—å®Œæ•´ <br>- ç”±ä½ çš„ Java æœåŠ¡åœ¨ API å±‚è„±æ•</td></tr></tbody></table><blockquote><p>ğŸ”‘ <strong>ç»“è®º</strong>ï¼š</p><ul><li><strong>ELK é€‚åˆæ—¥å¿—é‡‡é›†ä¸å­˜å‚¨ï¼Œä½†ä¸é€‚åˆå¤æ‚è„±æ•é€»è¾‘</strong>ã€‚</li><li>åº”é‡‡ç”¨ï¼š<strong>Filebeat â†’ ESï¼ˆå­˜æ˜æ–‡ï¼‰ â†’ Java API æœåŠ¡ï¼ˆå®æ—¶è„±æ•ï¼‰ â†’ å‰ç«¯å±•ç¤º</strong></li></ul></blockquote><hr><h3 id="å››ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#å››ã€æ€»ç»“"><span>å››ã€æ€»ç»“</span></a></h3><table><thead><tr><th>ç»„ä»¶</th><th>è§’è‰²</th><th>æ¨èç”¨é€”</th></tr></thead><tbody><tr><td><strong>Filebeat</strong></td><td>é‡‡é›†</td><td>è½»é‡é‡‡é›†æ—¥å¿—æ–‡ä»¶</td></tr><tr><td><strong>Logstash</strong></td><td>å¤„ç†</td><td>ç»“æ„åŒ–è§£æã€ enrichment</td></tr><tr><td><strong>Elasticsearch</strong></td><td>å­˜å‚¨</td><td>é«˜æ•ˆå­˜å‚¨ä¸æ£€ç´¢</td></tr><tr><td><strong>Kibana</strong></td><td>å±•ç¤º</td><td>å¯è§†åŒ–ä¸æŸ¥è¯¢</td></tr></tbody></table><hr><h2 id="ğŸ””-åŸºäº-docker-å®¹å™¨åŒ–æ–¹å¼æ­å»º-elk-filebeat-æ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#ğŸ””-åŸºäº-docker-å®¹å™¨åŒ–æ–¹å¼æ­å»º-elk-filebeat-æ¡†æ¶"><span>ğŸ”” åŸºäº Docker å®¹å™¨åŒ–æ–¹å¼æ­å»º ELK + Filebeat æ¡†æ¶</span></a></h2><blockquote><p>ğŸ’¡ ä½¿ç”¨ docker-compose æ–¹å¼ï¼Œè¿›è¡Œå®¹å™¨ç¼–æ’</p></blockquote><h3 id="ä¸€ã€æ¡†æ¶ç›®å½•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ¡†æ¶ç›®å½•ç»“æ„"><span>ä¸€ã€æ¡†æ¶ç›®å½•ç»“æ„</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./elk</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”œâ”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .env</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”œâ”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> data</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”œâ”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker-compose.yml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”œâ”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”‚</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   â””â”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> elasticsearch.yml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”œâ”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kibana</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”‚</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   â””â”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kibana.yml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”œâ”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filebeat</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â”‚</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   â””â”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filebeat.yml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">â””â”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> logstash</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    â”œâ”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> logstash.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    â””â”€â”€</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pipelines.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="äºŒã€å¿«é€Ÿé…ç½®åŠå¯åŠ¨å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#äºŒã€å¿«é€Ÿé…ç½®åŠå¯åŠ¨å®¹å™¨"><span>äºŒã€å¿«é€Ÿé…ç½®åŠå¯åŠ¨å®¹å™¨</span></a></h3><h4 id="_1ï¸âƒ£-ç¼–å†™å„ç»„ä»¶é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-ç¼–å†™å„ç»„ä»¶é…ç½®"><span>1ï¸âƒ£ ç¼–å†™å„ç»„ä»¶é…ç½®</span></a></h4><h5 id="elasticsearch-elasticsearch-yml" tabindex="-1"><a class="header-anchor" href="#elasticsearch-elasticsearch-yml"><span>elasticsearch/elasticsearch.yml</span></a></h5><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cluster.name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;docker-cluster-8.12.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">network.host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.0.0.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="logstash-pipelines-yml" tabindex="-1"><a class="header-anchor" href="#logstash-pipelines-yml"><span>logstash/pipelines.yml</span></a></h5><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pipeline.id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">main</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  path.config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/usr/share/logstash/pipeline/logstash.conf&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="logstash-logstash-conf" tabindex="-1"><a class="header-anchor" href="#logstash-logstash-conf"><span>logstash/logstash.conf</span></a></h5><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">input {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    beats {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        port =&gt; 5044</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">filter {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    grok {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        match =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            &quot;message&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =&gt; [</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                &quot;%{TIMESTAMP_ISO8601:timestamp} \| %{LOGLEVEL:level}%{SPACE}%{NUMBER:pid} \| %{DATA:thread_name} \[%{DATA:tid}\] %{DATA:logger}(?:\s*) \- \[%{DATA:method},%{NUMBER:line}\] \| %{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        overwrite =&gt; [&quot;message&quot;]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    date {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        match =&gt; [ &quot;timestamp&quot;, &quot;yyyy-MM-dd HH:mm:ss.SSS&quot; ]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        target =&gt; &quot;@timestamp&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        timestamp =&gt; &quot;Asia/Shanghai&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    mutate {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        remove_field =&gt; [ &quot;timestamp&quot;, &quot;host&quot;, &quot;agent&quot;, &quot;ecs&quot;, &quot;input&quot;, &quot;log&quot; ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">output {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    elasticsearch {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        hosts =&gt; [&quot;http://elasticsearch:9200&quot;]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        index =&gt; &quot;app-logs-%{+YYYY.MM.dd}&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # æŒ‡å®šæ”¶é›†æ—¥å¿—æ‰€å­˜å‚¨çš„ç´¢å¼•</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="filebeat-filebeat-yml" tabindex="-1"><a class="header-anchor" href="#filebeat-filebeat-yml"><span>filebeat/filebeat.yml</span></a></h5><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">filebeat.inputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">filestream</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    paths</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/logs/java-core/*.log</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">utf-8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    parsers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">multiline</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pattern</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d{3})?&#39;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          negate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          match</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">after</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    fields</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      app_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;log-elk&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      log_type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java-spring&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">processors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">add_docker_metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">~</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">output.logstash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;logstash:5044&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logging.level</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">debug</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logging.to_files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logging.to_stderr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logging.metrics.enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2ï¸âƒ£-é…ç½®å…¨å±€ç¯å¢ƒå˜é‡-env" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-é…ç½®å…¨å±€ç¯å¢ƒå˜é‡-env"><span>2ï¸âƒ£ é…ç½®å…¨å±€ç¯å¢ƒå˜é‡ <code>.env</code></span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># ç‰ˆæœ¬ä¿¡æ¯</span></span>
<span class="line"><span>ELK_VERSION=8.12.0</span></span>
<span class="line"><span>FILEBEAT_VERSION=8.12.0</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æ—¥å¿—ç›®å½•ï¼ˆæŒ‰ç…§ä¸šåŠ¡å®é™…çš„æ—¥å¿—æ”¶é›†ç›®å½•é…ç½®ï¼‰</span></span>
<span class="line"><span>LOGS_PATH=/data/logs</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Elasticsearch é…ç½®</span></span>
<span class="line"><span>ES_JAVA_OPTS=-Xms1g -Xmx1g</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Elasticsearch æ•°æ®æŒä¹…åŒ–ç›®å½•ï¼ˆå®¿ä¸»æœºè·¯å¾„ï¼‰</span></span>
<span class="line"><span>ES_DATA_PATH=./data/elasticsearch</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3ï¸âƒ£-ç¼–å†™å®¹å™¨ç¼–æ’-docker-compose-yaml" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-ç¼–å†™å®¹å™¨ç¼–æ’-docker-compose-yaml"><span>3ï¸âƒ£ ç¼–å†™å®¹å™¨ç¼–æ’ <code>docker-compose.yaml</code></span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># version: &#39;3.8&#39;   # ä½¿ç”¨ docker compose V1 ç‰ˆæœ¬çš„å®¹å™¨ç¼–æ’æŠ€æœ¯æ—¶ï¼Œéœ€è¦æŒ‡å®š versionã€‚é«˜ç‰ˆæœ¬çš„ä¸éœ€è¦æŒ‡å®šäº†</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å„æœåŠ¡ç»„ä»¶é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  elasticsearch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># elasticsearch é…ç½®é¡¹</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">docker.elastic.co/elasticsearch/elasticsearch:${ELK_VERSION}</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # æŒ‡å®šé•œåƒï¼ˆç‰ˆæœ¬ç»Ÿä¸€ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">elasticsearch</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          # æŒ‡å®šæœåŠ¡çš„å®¹å™¨å</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    environment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:              </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æœåŠ¡å®¹å™¨å¯åŠ¨æ—¶çš„ç¯å¢ƒé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">discovery.type=single-node</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          # å•æœºæ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">xpack.security.enabled=false</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # å…³é—­å®‰å…¨è®¤è¯ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®å¼€å¯ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ES_JAVA_OPTS=${ES_JAVA_OPTS}</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # é…ç½® JVM</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ulimits</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      memlock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        soft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        hard</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">${ES_DATA_PATH}:/usr/share/elasticsearch/data</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # æŒ‚è½½æ•°æ®æŒä¹…åŒ–</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./elasticsearch/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # æŒ‚è½½è‡ªå®šä¹‰é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;9200:9200&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          # æŒ‚è½½æ˜ å°„ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:           </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åŒä¸€ä¸ªå®¹å™¨ç¯å¢ƒä¸‹çš„ä¸“å±ç½‘ç»œ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">elk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  logstash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># logstash é…ç½®é¡¹</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">docker.elastic.co/logstash/logstash:${ELK_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">logstash</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    depends_on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./logstash/pipelines.yml:/usr/share/logstash/config/pipelines.yml:ro</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # è‡ªå®šä¹‰ç®¡é“é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./logstash/logstash.conf:/usr/share/logstash/pipeline/logstash.conf:ro</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # è‡ªå®šä¹‰Logstashé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;5044:5044&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">elk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  kibana</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kibana é…ç½®é¡¹</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">docker.elastic.co/kibana/kibana:${ELK_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kibana</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    depends_on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    environment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ELASTICSEARCH_HOSTS=http://elasticsearch:9200</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;5601:5601&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">elk</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  filebeat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># filebeat é…ç½®é¡¹</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">docker.elastic.co/beats/filebeat:${FILEBEAT_VERSION}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">filebeat</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    depends_on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">logstash</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./filebeat/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # è‡ªå®šä¹‰Filebeaté…ç½®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/lib/docker/containers:/var/lib/docker/containers:ro</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      # è¯»å–Dockerå®¹å™¨æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/run/docker.sock:/var/run/docker.sock:ro</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  # è¯»å–Dockerå®ˆæŠ¤è¿›ç¨‹ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">${LOGS_PATH}:/logs:ro</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                         # è¯»å–è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶ï¼ˆæŒ‰éœ€è°ƒæ•´ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">elk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  elk</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    driver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">bridge</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âš ï¸ æ³¨æ„ï¼š</p><ul><li>å¦‚æœä½ ä¸åœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œ Filebeatï¼ˆæ¯”å¦‚ Filebeat éƒ¨ç½²åœ¨å…¶ä»–æœåŠ¡å™¨ï¼‰ï¼Œåˆ™ä¸éœ€è¦åœ¨ <code>docker-compose.yml</code> ä¸­å®šä¹‰å®ƒï¼Œè€Œåº”å•ç‹¬éƒ¨ç½²ã€‚</li><li>è‹¥ä»…æµ‹è¯•ï¼Œå¯å…ˆæ³¨é‡Šæ‰ Filebeat æœåŠ¡ï¼Œæ‰‹åŠ¨ç”¨ <code>curl</code> æˆ– <code>log-generator</code> å‘ Logstash å‘é€æ—¥å¿—ã€‚</li></ul></blockquote><h4 id="_4ï¸âƒ£-å¯åŠ¨æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-å¯åŠ¨æœåŠ¡"><span>4ï¸âƒ£ å¯åŠ¨æœåŠ¡</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> elk</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹æ—¥å¿—</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å…³é—­æœåŠ¡</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é‡å¯æœåŠ¡</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æŒ‰éœ€é‡å¯æœåŠ¡</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">å®¹å™¨å/å®¹å™¨I</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">D&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">æˆ–</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # æ³¨æ„ï¼šdocker ps å¯ä»¥åœ¨å®¿ä¸»æœºçš„å…¨å±€ä»»æ„ä½ç½®æ‰§è¡Œï¼›docker compose ps å¿…é¡»è¿›å…¥åˆ°æœ‰ docker-compose.yml æ–‡ä»¶çš„æ–‡ä»¶å¤¹åï¼Œæ‰èƒ½æ‰§è¡Œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿›å…¥åˆ°æŒ‡å®šå®¹å™¨å†…éƒ¨ï¼Œè¿è¡Œå®¹å™¨å†…éƒ¨çš„ä¸€äº›å‘½ä»¤</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">å®¹å™¨å/å®¹å™¨I</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">D&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä½¿ç”¨ä¸Šé¢å‘½ä»¤åï¼Œå°±å¯ä»¥è¿›å…¥åˆ°æŒ‡å®šå®¹å™¨ä¸­ï¼Œç„¶ååœ¨å®¹å™¨ä¸­ä½¿ç”¨ llã€tail ç­‰å‘½ä»¤ï¼Œæ˜¯å¯¹å®¹å™¨ä¸­çš„å†…å®¹è¿›è¡Œæ“ä½œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5ï¸âƒ£-éªŒè¯æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#_5ï¸âƒ£-éªŒè¯æœåŠ¡"><span>5ï¸âƒ£ éªŒè¯æœåŠ¡</span></a></h4><ul><li>Elasticsearch: <a href="http://localhost:9200" target="_blank" rel="noopener noreferrer">http://localhost:9200</a></li><li>Kibana: <a href="http://localhost:5601" target="_blank" rel="noopener noreferrer">http://localhost:5601</a></li><li>åœ¨ Kibana ä¸­åˆ›å»ºç´¢å¼•æ¨¡å¼ï¼ˆå¦‚ <code>app-logs-*</code>ï¼‰ï¼Œå³å¯æŸ¥çœ‹æ—¥å¿—ã€‚</li></ul><h4 id="ğŸ”’-ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#ğŸ”’-ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹"><span>ğŸ”’ ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹</span></a></h4><ul><li>å¯ç”¨ TLS/SSL åŠ å¯†é€šä¿¡ã€‚</li><li>å¼€å¯ X-Pack å®‰å…¨è®¤è¯ï¼ˆè®¾ç½®ç”¨æˆ·åå¯†ç ï¼‰ã€‚</li><li>è°ƒæ•´ JVM å †å†…å­˜å¤§å°ã€‚</li><li>ä½¿ç”¨å¤–éƒ¨å­˜å‚¨å·æŒä¹…åŒ– Elasticsearch æ•°æ®ã€‚</li><li>Filebeat åº”éƒ¨ç½²åœ¨å„ä¸šåŠ¡æœåŠ¡å™¨ä¸Šï¼Œè€Œéä¸ ELK åŒå®¹å™¨ã€‚</li></ul><h3 id="ä¸‰ã€å„æ–‡ä»¶é…ç½®è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å„æ–‡ä»¶é…ç½®è¯¦è§£"><span>ä¸‰ã€å„æ–‡ä»¶é…ç½®è¯¦è§£</span></a></h3><h4 id="_1-elasticsearch-elasticsearch-yml" tabindex="-1"><a class="header-anchor" href="#_1-elasticsearch-elasticsearch-yml"><span>1. elasticsearch/elasticsearch.yml</span></a></h4><p>ğŸ“Œ <strong>åŠŸèƒ½</strong></p><p>Elasticsearch çš„ä¸»é…ç½®æ–‡ä»¶ï¼Œæ§åˆ¶èŠ‚ç‚¹è¡Œä¸ºã€ç½‘ç»œã€é›†ç¾¤ã€å®‰å…¨ç­‰æ ¸å¿ƒè®¾ç½®</p><p>ğŸ·ï¸ <strong>é…ç½®é¡¹è¯¦è§£</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cluster.name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;docker-cluster-8.12.0&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>ä½œç”¨</strong>ï¼šå®šä¹‰é›†ç¾¤åç§°ã€‚åŒä¸€é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„åç§°ã€‚</li><li><strong>è¯´æ˜</strong>ï¼šåœ¨å•èŠ‚ç‚¹å¼€å‘ç¯å¢ƒä¸­å¯éšæ„å‘½åï¼›ç”Ÿäº§ç¯å¢ƒéœ€ç»Ÿä¸€ã€‚</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">network.host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.0.0.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>ä½œç”¨</strong>ï¼šç»‘å®šç›‘å¬åœ°å€ã€‚<code>0.0.0.0</code> è¡¨ç¤ºæ¥å—æ‰€æœ‰ IP çš„è¿æ¥ï¼ˆåŒ…æ‹¬å®¹å™¨é—´é€šä¿¡å’Œå¤–éƒ¨è®¿é—®ï¼‰ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šElasticsearch é»˜è®¤åªç›‘å¬ <code>localhost</code>ï¼Œåœ¨ Docker ä¸­å¿…é¡»æ”¹ä¸º <code>0.0.0.0</code> æ‰èƒ½è¢«å…¶ä»–æœåŠ¡è®¿é—®ã€‚</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xpack.security.enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>ä½œç”¨</strong>ï¼šå…³é—­ X-Pack å®‰å…¨åŠŸèƒ½ï¼ˆå¦‚ç”¨æˆ·è®¤è¯ã€TLSï¼‰ã€‚</li><li><strong>å»ºè®®</strong>ï¼šå¼€å‘ç¯å¢ƒå…³é—­ä»¥ç®€åŒ–éƒ¨ç½²ï¼›ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…å¼€å¯ï¼Œå¹¶è®¾ç½®å¼ºå¯†ç ã€‚</li></ul><blockquote><p>ğŸ’¡ å…¶ä»–å¸¸è§é…ç½®ï¼ˆç”Ÿäº§ç”¨ï¼‰ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path.data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/lib/elasticsearch</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # æ•°æ®ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path.logs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/log/elasticsearch</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # æ—¥å¿—ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bootstrap.memory_lock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # é”å®šå†…å­˜ï¼Œé˜²æ­¢äº¤æ¢</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h4 id="_2-kibana-kibana-yml" tabindex="-1"><a class="header-anchor" href="#_2-kibana-kibana-yml"><span>2. kibana/kibana.yml</span></a></h4><p>ğŸ“Œ <strong>åŠŸèƒ½</strong></p><p>Kibana çš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºè¿æ¥ Elasticsearchã€è®¾ç½®ç•Œé¢è¯­è¨€ã€å¯ç”¨æ’ä»¶ç­‰ã€‚</p><p>ğŸ·ï¸ <strong>é…ç½®é¡¹è¯¦è§£</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">server.name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kibana</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>ä½œç”¨</strong>ï¼šKibana å®ä¾‹çš„åç§°ï¼Œä¸»è¦ç”¨äºæ—¥å¿—æ ‡è¯†ã€‚</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">server.host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;0.0.0.0&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>ä½œç”¨</strong>ï¼šå…è®¸ Kibana Web æœåŠ¡è¢«å¤–éƒ¨è®¿é—®ï¼ˆé»˜è®¤åªç›‘å¬ <code>localhost</code>ï¼‰ã€‚</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">elasticsearch.hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://elasticsearch:9200&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>ä½œç”¨</strong>ï¼šæŒ‡å®š Elasticsearch åœ°å€ã€‚</li><li><strong>å…³é”®ç‚¹</strong>ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯ <strong>Docker æœåŠ¡å <code>elasticsearch</code></strong>ï¼Œå› ä¸ºå®ƒä»¬åœ¨åŒä¸€è‡ªå®šä¹‰ç½‘ç»œ <code>elk</code> ä¸­ï¼Œå¯é€šè¿‡æœåŠ¡å DNS è§£æã€‚</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">monitoring.ui.container.elasticsearch.enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>ä½œç”¨</strong>ï¼šåœ¨ Kibana ç›‘æ§é¡µé¢ä¸­æ˜¾ç¤º Elasticsearch å®¹å™¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ã€‚</li></ul><blockquote><p>ğŸ’¡ å…¶ä»–å¸¸ç”¨é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">i18n.locale</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;zh-CN&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   # ä¸­æ–‡ç•Œé¢</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">elasticsearch.username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;kibana_system&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">elasticsearch.password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;xxxx&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # è‹¥å¯ç”¨äº†å®‰å…¨è®¤è¯</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">server.publicBaseUrl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;https://kibana.example.com&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # åå‘ä»£ç†æ—¶è®¾ç½®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h4 id="_3-logstash-logstash-conf" tabindex="-1"><a class="header-anchor" href="#_3-logstash-logstash-conf"><span>3. logstash/logstash.conf</span></a></h4><p><strong>åŠŸèƒ½ï¼š</strong></p><ul><li>å®šä¹‰æ•°æ®å¤„ç†æµæ°´çº¿ï¼ˆinput â†’ filter â†’ outputï¼‰ã€‚</li></ul><p><strong>é…ç½®é¡¹è¯¦è§£ï¼š</strong></p><ul><li><strong>Inputï¼ˆè¾“å…¥ï¼‰</strong><ul><li><strong>ä½œç”¨</strong>ï¼šç›‘å¬ 5044 ç«¯å£ï¼Œæ¥æ”¶æ¥è‡ª Filebeat çš„æ—¥å¿—ã€‚</li><li><strong>åè®®</strong>ï¼šä½¿ç”¨ Beats åè®®ï¼ˆè½»é‡ã€å¯é ã€æ”¯æŒ ACKï¼‰ã€‚</li></ul></li></ul><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>input {</span></span>
<span class="line"><span>  beats {</span></span>
<span class="line"><span>    port =&gt; 5044</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Filterï¼ˆè¿‡æ»¤å™¨ï¼Œå¯é€‰ï¼‰</strong><ul><li>å…¸å‹ç”¨é€”ï¼š <ul><li>ä½¿ç”¨ <code>grok</code> è§£æ Nginx/Apache æ—¥å¿—ã€‚</li><li>æå–æ—¶é—´æˆ³å¹¶è®¾ç½® <code>@timestamp</code>ã€‚</li><li>æ·»åŠ å­—æ®µï¼ˆå¦‚ <code>env =&gt; &quot;prod&quot;</code>ï¼‰ã€‚</li></ul></li></ul></li></ul><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>filter {</span></span>
<span class="line"><span>  # grok, date, mutate ç­‰æ’ä»¶åœ¨æ­¤å¤„ç†æ—¥å¿—æ ¼å¼</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ç¤ºä¾‹ï¼ˆNginx è®¿é—®æ—¥å¿—ï¼‰ï¼š</p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>grok {</span></span>
<span class="line"><span>  match =&gt; { &quot;message&quot; =&gt; &quot;%{COMBINEDAPACHELOG}&quot; }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>date {</span></span>
<span class="line"><span>  match =&gt; [ &quot;timestamp&quot;, &quot;dd/MMM/yyyy:HH:mm:ss Z&quot; ]</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><ul><li><strong>Outputï¼ˆè¾“å‡ºï¼‰</strong><ul><li><strong>hosts</strong>ï¼šElasticsearch åœ°å€ï¼ˆå®¹å™¨å†…é€šè¿‡æœåŠ¡åè®¿é—®ï¼‰ã€‚</li><li><strong>index</strong>ï¼šåŠ¨æ€ç´¢å¼•åï¼ŒæŒ‰å¤©åˆ›å»ºï¼ˆä¾¿äºç®¡ç†ä¸æ¸…ç†ï¼‰ã€‚</li><li>å…¶ä»–é€‰é¡¹ï¼š <ul><li><code>user/password</code>ï¼šè‹¥å¯ç”¨äº†å®‰å…¨è®¤è¯ã€‚</li><li><code>ssl_certificate_verification =&gt; false</code>ï¼šæµ‹è¯•æ—¶è·³è¿‡è¯ä¹¦éªŒè¯ã€‚</li></ul></li></ul></li></ul><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>output {</span></span>
<span class="line"><span>  elasticsearch {</span></span>
<span class="line"><span>    hosts =&gt; [&quot;http://elasticsearch:9200&quot;]</span></span>
<span class="line"><span>    index =&gt; &quot;logs-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-filebeat-filebeat-yml" tabindex="-1"><a class="header-anchor" href="#_4-filebeat-filebeat-yml"><span>4. filebeat/filebeat.yml</span></a></h4><p><strong>åŠŸèƒ½ï¼š</strong></p><ul><li>Filebeat çš„é‡‡é›†ä¸è¾“å‡ºé…ç½®ï¼Œå†³å®šâ€œé‡‡é›†ä»€ä¹ˆâ€å’Œâ€œå‘åˆ°å“ªé‡Œâ€ã€‚</li></ul><p><strong>é…ç½®é¡¹è¯¦è§£ï¼š</strong></p><ul><li><strong>è¾“å…¥ï¼ˆé‡‡é›†æ—¥å¿—ï¼‰</strong><ul><li><strong>type: filestream</strong>ï¼šFilebeat 8.x æ¨èçš„æ–°è¾“å…¥ç±»å‹ï¼ˆæ›¿ä»£æ—§çš„ <code>log</code>ï¼‰ï¼Œæ”¯æŒæ›´é«˜æ•ˆçš„æ–‡ä»¶è¿½è¸ªã€‚</li><li><strong>paths</strong>ï¼šè¦ç›‘æ§çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰ã€‚</li><li><strong>æŒ‚è½½è¯´æ˜</strong>ï¼šåœ¨ Docker ä¸­éœ€å°†å®¿ä¸»æœºæ—¥å¿—ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ï¼ˆå¦‚ <code>- /var/log:/var/log</code>ï¼‰ã€‚</li></ul></li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">filebeat.inputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">filestream</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  paths</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/log/*.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ’¡ å…¶ä»–è¾“å…¥ç±»å‹ï¼š</p><ul><li><code>container</code>ï¼šç›´æ¥è¯»å– Docker å®¹å™¨æ—¥å¿—ï¼ˆéœ€æŒ‚è½½ <code>/var/lib/docker/containers</code>ï¼‰ã€‚</li><li>æ”¯æŒå¤š inputï¼Œå¯åŒæ—¶é‡‡é›†ç³»ç»Ÿæ—¥å¿—ã€åº”ç”¨æ—¥å¿—ç­‰ã€‚</li></ul></blockquote><ul><li><strong>è¾“å‡ºï¼ˆå‘é€ç›®çš„åœ°ï¼‰</strong><ul><li><strong>è¯´æ˜</strong>ï¼šå‘é€åˆ°åŒç½‘ç»œä¸­çš„ Logstash æœåŠ¡ã€‚</li><li><strong>ä¼˜åŠ¿</strong>ï¼šLogstash å¯åšå¤æ‚è§£æï¼ŒFilebeat ä¿æŒè½»é‡ã€‚</li></ul></li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">output.logstash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;logstash:5044&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âœ… æ›¿ä»£æ–¹æ¡ˆï¼ˆç›´è¿ ESï¼‰ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">output.elasticsearch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;elasticsearch:9200&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>é€‚ç”¨äºç®€å•åœºæ™¯ï¼ˆæ— éœ€å¤æ‚è¿‡æ»¤ï¼‰ï¼Œæ€§èƒ½æ›´é«˜ã€‚</p></blockquote><ul><li><strong>å…¶ä»–é‡è¦é…ç½®ï¼ˆå¯é€‰ï¼‰</strong><ul><li><strong>ä½œç”¨</strong>ï¼šè‡ªåŠ¨åŠ è½½ Kibana ä»ªè¡¨ç›˜å’Œ Elasticsearch ç´¢å¼•æ¨¡æ¿ï¼ˆéœ€é¦–æ¬¡è¿è¡Œæ—¶å¯ç”¨ï¼‰ã€‚</li></ul></li></ul><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">setup.kibana</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  host</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;kibana:5601&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">setup.template.enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">setup.template.name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">setup.template.pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;filebeat-*&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ”-æ€»ç»“-å„ç»„ä»¶åä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#ğŸ”-æ€»ç»“-å„ç»„ä»¶åä½œæµç¨‹"><span>ğŸ” æ€»ç»“ï¼šå„ç»„ä»¶åä½œæµç¨‹</span></a></h4><ol><li><strong>Filebeat</strong> ç›‘æ§æœ¬åœ°æ—¥å¿—æ–‡ä»¶ â†’ è¯»å–æ–°å¢å†…å®¹ã€‚</li><li>å°†æ—¥å¿—é€šè¿‡ <strong>Beats åè®®</strong> å‘é€åˆ° <strong>Logstash:5044</strong>ã€‚</li><li><strong>Logstash</strong> æ¥æ”¶åï¼Œç»è¿‡ <code>filter</code> å¤„ç†ï¼ˆå¦‚è§£æã€ä¸°å¯Œå­—æ®µï¼‰ã€‚</li><li>å°†ç»“æ„åŒ–æ—¥å¿—å†™å…¥ <strong>Elasticsearch</strong> çš„ <code>logs-2025.11.14</code> ç´¢å¼•ã€‚</li><li><strong>Kibana</strong> è¿æ¥ Elasticsearchï¼Œç”¨æˆ·é€šè¿‡ Web ç•Œé¢æŸ¥è¯¢ã€å¯è§†åŒ–æ—¥å¿—ã€‚</li></ol><h2 id="ğŸ“-å®é™…ç”Ÿäº§ä¸­çš„æ—¥å¿—è„±æ•è¿‡ç¨‹æ¢ç´¢" tabindex="-1"><a class="header-anchor" href="#ğŸ“-å®é™…ç”Ÿäº§ä¸­çš„æ—¥å¿—è„±æ•è¿‡ç¨‹æ¢ç´¢"><span>ğŸ“ å®é™…ç”Ÿäº§ä¸­çš„æ—¥å¿—è„±æ•è¿‡ç¨‹æ¢ç´¢</span></a></h2><h3 id="ä¸€ã€å‰è¨€" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€å‰è¨€"><span>ä¸€ã€å‰è¨€</span></a></h3><p>å› ä¸šåŠ¡æ—¥å¿—ä¸­å­˜åœ¨æ•æ„Ÿä¿¡æ¯ï¼ˆæ¯”å¦‚ï¼Œç”¨æˆ·æ‰‹æœºå·ã€ç”¨æˆ·èº«ä»½è¯å·ã€é“¶è¡Œå¡å·ç­‰ï¼‰ï¼Œè¿™äº›æ•æ„Ÿä¿¡æ¯å¯¹äºç½‘ç»œå®‰å…¨æ–¹é¢å­˜åœ¨è‡´å‘½é—®é¢˜ï¼Œå®¹æ˜“é€ æˆä¿¡æ¯æ³„éœ²ï¼Œå› æ­¤éœ€è¦å¯¹æ—¥å¿—ä¸­çš„æ•æ„Ÿä¿¡æ¯è¿›è¡Œè„±æ•å¤„ç†ã€‚ä½†å› ä¸ºå­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ç‚¹ï¼š</p><ol><li>ä¸šåŠ¡ç³»ç»Ÿè¾ƒå¤šï¼Œæ—¥å¿—æ‰“å°æ ¼å¼ä¸è§„èŒƒ</li><li>ä¸šåŠ¡å·²ç»å±äºæˆç†Ÿç³»ç»Ÿï¼Œæ”¹é€ èµ·æ¥æ¯”è¾ƒè´¹äº‹</li></ol><p>é’ˆå¯¹è¿™ä¸¤ä¸ªé—®é¢˜ï¼ŒèŒç”Ÿäº†ä» ELK + Filebeat æ¡†æ¶æ”¶é›†æ—¥å¿—çš„è¿‡ç¨‹ä¸­å»å¤„ç†æ•æ„Ÿä¿¡æ¯çš„è„±æ•é—®é¢˜ï¼Œä»è€Œæ‰“ç®—ä» logstash æ—¥å¿—æ¸…æ´—è¿‡æ»¤çš„è¿‡ç¨‹å…¥æ‰‹ï¼Œå¯¹æ”¶é›†åˆ°çš„æ—¥å¿—è¿›è¡Œè¯†åˆ«ã€åˆ†æã€è„±æ•ã€å­˜å‚¨ï¼Œæ¥è¾¾åˆ°æŒ‡å®šçš„æ•ˆæœã€‚</p><h3 id="äºŒã€æ—¶é—´è¿‡ç¨‹-â€”â€”-filebeat-é…ç½®æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ—¶é—´è¿‡ç¨‹-â€”â€”-filebeat-é…ç½®æ–¹æ¡ˆ"><span>äºŒã€æ—¶é—´è¿‡ç¨‹ â€”â€” filebeat é…ç½®æ–¹æ¡ˆ</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">filebeat.inputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">filestream</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    paths</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/logs/java-core/*.log</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    encoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">utf-8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    parsers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">multiline</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:     </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># è¿™é‡Œè¦ä½¿ç”¨ multiline è¿›è¡Œå¤šè¡Œåˆå¹¶ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³æ‰“å°å¼‚å¸¸æ—¥å¿— exception æ—¶ï¼Œæ—¥å¿—åˆ†ä¸ºå¤šè¡Œçš„é—®é¢˜</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pattern</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          pattern</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d{3})?&#39;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          negate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          match</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">after</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    fields</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      app_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;log-elk&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      log_type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;java-spring&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">processors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">add_docker_metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">~</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # å¯è‡ªåŠ¨é™„åŠ å®¹å™¨ä¿¡æ¯ï¼ˆå¦‚é•œåƒåã€å®¹å™¨ ID ç­‰ï¼‰ï¼Œä¾¿äºè¿½è¸ª</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ§åˆ¶å°ç›´æ¥æ‰“å°ï¼ˆç”¨äºè°ƒè¯•ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># output.console:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#   pretty: true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">output.logstash</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;logstash:5044&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logging.level</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">debug</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logging.to_files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logging.to_stderr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">logging.metrics.enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸‰ã€å®è·µè¿‡ç¨‹-â€”â€”-logstash-é…ç½®æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å®è·µè¿‡ç¨‹-â€”â€”-logstash-é…ç½®æ–¹æ¡ˆ"><span>ä¸‰ã€å®è·µè¿‡ç¨‹ â€”â€” logstash é…ç½®æ–¹æ¡ˆ</span></a></h3><h4 id="_1ï¸âƒ£-æŒ‰ç…§æŒ‡å®šçš„å­—æ®µè¿›è¡Œè„±æ•å¤„ç†é…ç½®æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-æŒ‰ç…§æŒ‡å®šçš„å­—æ®µè¿›è¡Œè„±æ•å¤„ç†é…ç½®æ–¹æ¡ˆ"><span>1ï¸âƒ£ æŒ‰ç…§æŒ‡å®šçš„å­—æ®µè¿›è¡Œè„±æ•å¤„ç†é…ç½®æ–¹æ¡ˆ</span></a></h4><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>input {</span></span>
<span class="line"><span>    beats {</span></span>
<span class="line"><span>        port =&gt; 5044</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>filter {</span></span>
<span class="line"><span>    grok {</span></span>
<span class="line"><span>        match =&gt; {</span></span>
<span class="line"><span>            &quot;message&quot; =&gt; [</span></span>
<span class="line"><span>                &quot;%{TIMESTAMP_ISO8601:timestamp}%{SPACE}\|%{SPACE}%{LOGLEVEL:level}%{SPACE}%{NUMBER:pid:int}%{SPACE}\|%{SPACE}%{DATA:thread_name}%{SPACE}\[TID:%{DATA:tid}\]%{SPACE}%{DATA:logger}%{SPACE}\-%{SPACE}\[%{DATA:method},%{NUMBER:line:int}\]%{SPACE}\|%{SPACE}%{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        overwrite =&gt; [&quot;message&quot;]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        strip =&gt; [&quot;tid_raw&quot;]</span></span>
<span class="line"><span>        rename =&gt; {&quot;tid_raw&quot; =&gt; &quot;tid&quot; }</span></span>
<span class="line"><span>        strip =&gt; [&quot;logger&quot;]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if ![pid] or [pid] =~ /^[^0-9]+$/ {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;pid&quot; =&gt; &quot;0&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![thread_name] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;thread_name&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }  </span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![tid] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;tid&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![method] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;method&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![line] or [line] =~ /^[^0-9]+$/ {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;line&quot; =&gt; &quot;0&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![logger] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;logger&quot; =&gt; &quot;unknown&quot; } </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        convert =&gt; {</span></span>
<span class="line"><span>            &quot;pid&quot; =&gt; &quot;integer&quot;</span></span>
<span class="line"><span>            &quot;line&quot; =&gt; &quot;integer&quot;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    date {</span></span>
<span class="line"><span>        match =&gt; [ &quot;timestamp&quot;, &quot;yyyy-MM-dd HH:mm:ss.SSS&quot; ]</span></span>
<span class="line"><span>        target =&gt; &quot;@timestamp&quot;</span></span>
<span class="line"><span>        timezone =&gt; &quot;Asia/Shanghai&quot;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    json {</span></span>
<span class="line"><span>        source =&gt; &quot;msg&quot;</span></span>
<span class="line"><span>        target =&gt; &quot;parsed_msg&quot;</span></span>
<span class="line"><span>        tag_on_failure =&gt; [ &quot;_not_json&quot; ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if &quot;_not_json&quot; not in [tags] {</span></span>
<span class="line"><span>        ruby {</span></span>
<span class="line"><span>            code =&gt; &#39;</span></span>
<span class="line"><span>                ip = event.get(&quot;[parsed_msg][operIp]&quot;)</span></span>
<span class="line"><span>                if ip.is_a?(String)</span></span>
<span class="line"><span>                    event.set(&quot;[parsed_msg][operIp]&quot;, ip.gsub(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/, &quot;***.***.***.***&quot;))</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span>                userCode = event.get(&quot;[parsed_msg][operUserCode]&quot;)</span></span>
<span class="line"><span>                if userCode.is_a?(String)</span></span>
<span class="line"><span>                    clean = userCode.gsub(/[\s\\-\\(\\)]/, &quot;&quot;)</span></span>
<span class="line"><span>                    masked = userCode</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    if clean.start_with?(&quot;+&quot;) &amp;&amp; clean.match?(/^\\+\\d{1,3}\\d+$/)</span></span>
<span class="line"><span>                        if clean =~ /^(\\+\\d{1,3})(\\d+)$/</span></span>
<span class="line"><span>                            cc = $1</span></span>
<span class="line"><span>                            num = $2</span></span>
<span class="line"><span>                            if num.length &gt;= 7</span></span>
<span class="line"><span>                                masked = cc + num[0,3] + &quot;****&quot; + num[-4..-1]</span></span>
<span class="line"><span>                            elsif num.length &gt;= 4</span></span>
<span class="line"><span>                                masked = cc + num[0,2] + &quot;****&quot; + num[-2..-1]</span></span>
<span class="line"><span>                            else</span></span>
<span class="line"><span>                                masked = cc + (&quot;*&quot; * num.length)</span></span>
<span class="line"><span>                            end</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    else</span></span>
<span class="line"><span>                        digits = clean.gsub(/\\D/, &quot;&quot;)</span></span>
<span class="line"><span>                        if digits.length &gt;= 7</span></span>
<span class="line"><span>                            masked = digits[0,3] + &quot;****&quot; + digits[-4..-1]</span></span>
<span class="line"><span>                        elsif digits.length &gt;= 4</span></span>
<span class="line"><span>                            masked = digits[0,2] + &quot;****&quot; + digits[-2..-1]</span></span>
<span class="line"><span>                        else</span></span>
<span class="line"><span>                            masked = &quot;*&quot; * [digits.length, 6].min</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                    event.set(&quot;[parsed_msg][operUserCode]&quot;, masked)</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span>            &#39;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if [parsed_msg][outputJson] {</span></span>
<span class="line"><span>            json {</span></span>
<span class="line"><span>                source =&gt; &quot;[parsed_msg][outputJson]&quot;</span></span>
<span class="line"><span>                target =&gt; &quot;[parsed_msg][outputJson_parsed]&quot;</span></span>
<span class="line"><span>                tag_on_failure =&gt; [ &quot;_outputJson_not_json&quot; ]</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            if &quot;_outputJson_not_json&quot; not in [tags] {</span></span>
<span class="line"><span>                ruby {</span></span>
<span class="line"><span>                    code =&gt; &#39;</span></span>
<span class="line"><span>                        arr = event.get(&quot;[parsed_msg][outputJson_parsed]&quot;)</span></span>
<span class="line"><span>                        if arr.is_a?(Array)</span></span>
<span class="line"><span>                            arr.each do |item|</span></span>
<span class="line"><span>                                if item.is_a?(Hash)</span></span>
<span class="line"><span>                                    if item[&quot;userCode&quot;] &amp;&amp; item[&quot;userCode&quot;].is_a?(String)</span></span>
<span class="line"><span>                                        raw = item[&quot;userCode&quot;]</span></span>
<span class="line"><span>                                        clean = raw.gsub(/[\s\-\(\)]/, &quot;&quot;)</span></span>
<span class="line"><span>                                        is_phone = false</span></span>
<span class="line"><span>                                        masked = raw</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                                        if clean.start_with?(&quot;+&quot;)</span></span>
<span class="line"><span>                                            if clean.match?(/^\+\d{7,15}$/)</span></span>
<span class="line"><span>                                                is_phone = true</span></span>
<span class="line"><span>                                            end</span></span>
<span class="line"><span>                                        else</span></span>
<span class="line"><span>                                            if clean.match?(/^\d{7,15}$/)</span></span>
<span class="line"><span>                                                is_phone = true</span></span>
<span class="line"><span>                                            end</span></span>
<span class="line"><span>                                        end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                                        if is_phone</span></span>
<span class="line"><span>                                            if clean.start_with?(&quot;+&quot;)</span></span>
<span class="line"><span>                                                if clean =~ /^(\+\d{1,3})(\d+)$/</span></span>
<span class="line"><span>                                                    cc = $1</span></span>
<span class="line"><span>                                                    num = $2</span></span>
<span class="line"><span>                                                    if num.length &gt;= 7</span></span>
<span class="line"><span>                                                        masked = cc + num[0,3] + &quot;****&quot; + num[-4..-1]</span></span>
<span class="line"><span>                                                    elsif num.length &gt;= 4</span></span>
<span class="line"><span>                                                        masked = cc + num[0,2] + &quot;****&quot; + num[-2..-1]</span></span>
<span class="line"><span>                                                    else</span></span>
<span class="line"><span>                                                        masked = cc + (&quot;*&quot; * num.length)</span></span>
<span class="line"><span>                                                    end</span></span>
<span class="line"><span>                                                else</span></span>
<span class="line"><span>                                                    masked = &quot;*&quot; * [clean.length, 10].min</span></span>
<span class="line"><span>                                                end</span></span>
<span class="line"><span>                                            else</span></span>
<span class="line"><span>                                                digits = clean</span></span>
<span class="line"><span>                                                if digits.length &gt;= 7</span></span>
<span class="line"><span>                                                    masked = digits[0,3] + &quot;****&quot; + digits[-4..-1]</span></span>
<span class="line"><span>                                                elsif digits.length &gt;= 4</span></span>
<span class="line"><span>                                                    masked = digits[0,2] + &quot;****&quot; + digits[-2..-1]</span></span>
<span class="line"><span>                                                else</span></span>
<span class="line"><span>                                                    masked = &quot;*&quot; * digits.length</span></span>
<span class="line"><span>                                                end</span></span>
<span class="line"><span>                                            end</span></span>
<span class="line"><span>                                        end</span></span>
<span class="line"><span>                                        item[&quot;userCode&quot;] = masked</span></span>
<span class="line"><span>                                    end</span></span>
<span class="line"><span>                                    if item[&quot;userPhone&quot;] &amp;&amp; item[&quot;userPhone&quot;].is_a?(String)</span></span>
<span class="line"><span>                                        clean = item[&quot;userPhone&quot;].gsub(/[\s\-\(\)]/, &quot;&quot;)</span></span>
<span class="line"><span>                                        masked = item[&quot;userPhone&quot;]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                                        if clean.start_with?(&quot;+&quot;) &amp;&amp; clean.match?(/^\+\d{1,3}\d+$/)</span></span>
<span class="line"><span>                                            if clean =~ /^(\+\d{1,3})(\d+)$/</span></span>
<span class="line"><span>                                                cc = $1</span></span>
<span class="line"><span>                                                num = $2</span></span>
<span class="line"><span>                                                if num.length &gt;= 7</span></span>
<span class="line"><span>                                                    masked = cc + num[0,3] + &quot;****&quot; + num[-4..-1]</span></span>
<span class="line"><span>                                                elsif num.length &gt;= 4</span></span>
<span class="line"><span>                                                    masked = cc + num[0,2] + &quot;****&quot; + num[-2..-1]</span></span>
<span class="line"><span>                                                else</span></span>
<span class="line"><span>                                                    masked = cc + (&quot;*&quot; * num.length)</span></span>
<span class="line"><span>                                                end</span></span>
<span class="line"><span>                                            end</span></span>
<span class="line"><span>                                        else</span></span>
<span class="line"><span>                                            digits = clean.gsub(/\D/, &quot;&quot;)</span></span>
<span class="line"><span>                                            if digits.length &gt;= 7</span></span>
<span class="line"><span>                                                masked = digits[0,3] + &quot;****&quot; + digits[-4..-1]</span></span>
<span class="line"><span>                                            elsif digits.length &gt;= 4</span></span>
<span class="line"><span>                                                masked = digits[0,2] + &quot;****&quot; + digits[-2..-1]</span></span>
<span class="line"><span>                                            else</span></span>
<span class="line"><span>                                                masked = &quot;*&quot; * [digits.length, 6].min</span></span>
<span class="line"><span>                                            end</span></span>
<span class="line"><span>                                        end</span></span>
<span class="line"><span>                                        item[&quot;userPhone&quot;] = masked</span></span>
<span class="line"><span>                                    end</span></span>
<span class="line"><span>                                    if item[&quot;idCard&quot;] &amp;&amp; item[&quot;idCard&quot;].is_a?(String) &amp;&amp; item[&quot;idCard&quot;].length == 18</span></span>
<span class="line"><span>                                        item[&quot;idCard&quot;] = item[&quot;idCard&quot;].gsub(/(\d{6})\d{8}(\d{4})/, &quot;\\1********\\2&quot;)</span></span>
<span class="line"><span>                                    end</span></span>
<span class="line"><span>                                    if item[&quot;userEmail&quot;] &amp;&amp; item[&quot;userEmail&quot;].is_a?(String) &amp;&amp; item[&quot;userEmail&quot;].include?(&quot;@&quot;)</span></span>
<span class="line"><span>                                        parts = item[&quot;userEmail&quot;].split(&quot;@&quot;, 2)</span></span>
<span class="line"><span>                                        if parts.length == 2</span></span>
<span class="line"><span>                                            local = parts[0]</span></span>
<span class="line"><span>                                            domain = parts[1]</span></span>
<span class="line"><span>                                            masked_local = (local.length &lt;= 3) ? local + &quot;****&quot; : local[0,3] + &quot;****&quot;</span></span>
<span class="line"><span>                                            item[&quot;userEmail&quot;] = masked_local + &quot;@&quot; + domain</span></span>
<span class="line"><span>                                        end</span></span>
<span class="line"><span>                                    end</span></span>
<span class="line"><span>                                end</span></span>
<span class="line"><span>                            end</span></span>
<span class="line"><span>                            event.set(&quot;[parsed_msg][outputJson_parsed]&quot;, arr)</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    &#39;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>                ruby {</span></span>
<span class="line"><span>                    code =&gt; &#39;</span></span>
<span class="line"><span>                        arr = event.get(&quot;[parsed_msg][outputJson_parsed]&quot;)</span></span>
<span class="line"><span>                        if arr</span></span>
<span class="line"><span>                            event.set(&quot;[parsed_msg][outputJson]&quot;, JSON.generate(arr))</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    &#39;</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>                mutate {</span></span>
<span class="line"><span>                    remove_field =&gt; [ &quot;[parsed_msg][outputJson_parsed]&quot; ]</span></span>
<span class="line"><span>                }</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } </span></span>
<span class="line"><span>    else {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            gsub =&gt; [</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b&quot;, &quot;***.***.***.***&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;(\\d{3})\\d{4}(\\d{4})&quot;, &quot;\\1****\\3&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;([a-zA-Z0-9])([a-zA-Z0-9._%+-]*)@([a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})&quot;, &quot;\\1***@\\3&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;(\\d{6})\\d{8}(\\d{4})&quot;, &quot;\\1**********\\2&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;([9][1-9A-HJ-NPQRTUWXY]{2})[1-9A-HJ-NPQRTUWXY]{14}([1-9A-HJ-NPQRTUWXY0-9]{2})&quot;, &quot;\\1**************\\2&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;(\\+\\d{1,3})[\\s\\-\\.\\(\\)]*(\\d{2,10})[\\s\\-\\.\\(\\)]*(\\d{4})&quot;, &quot;\\1****\\3&quot;</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ruby {</span></span>
<span class="line"><span>        code =&gt; &#39;</span></span>
<span class="line"><span>            event.set(&quot;msg&quot;, event.get(&quot;parsed_msg&quot;).to_json)</span></span>
<span class="line"><span>        &#39;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        remove_tag =&gt; [ &quot;_not_json&quot;, &quot;_outputJson_not_json&quot; ]</span></span>
<span class="line"><span>        remove_field =&gt; [ &quot;timestamp&quot;, &quot;message&quot;, &quot;parsed_msg&quot;, &quot;event&quot;, &quot;score&quot;, &quot;tags&quot;, &quot;host&quot;, &quot;agent&quot;, &quot;ecs&quot;, &quot;input&quot;, &quot;log&quot; ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>    elasticsearch {</span></span>
<span class="line"><span>        hosts =&gt; [&quot;http://elasticsearch:9200&quot;]</span></span>
<span class="line"><span>        index =&gt; &quot;app-logs-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    stdout {</span></span>
<span class="line"><span>        codec =&gt; rubydebug</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2ï¸âƒ£-ä¸æŒ‡å®šå­—æ®µ-ä½¿ç”¨é€’å½’å‡½æ•°æ¨¡ç³ŠåŒ¹é…æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-ä¸æŒ‡å®šå­—æ®µ-ä½¿ç”¨é€’å½’å‡½æ•°æ¨¡ç³ŠåŒ¹é…æ–¹æ¡ˆ"><span>2ï¸âƒ£ ä¸æŒ‡å®šå­—æ®µï¼Œä½¿ç”¨é€’å½’å‡½æ•°æ¨¡ç³ŠåŒ¹é…æ–¹æ¡ˆ</span></a></h4><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>input {</span></span>
<span class="line"><span>    beats {</span></span>
<span class="line"><span>        port =&gt; 5044</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>filter {</span></span>
<span class="line"><span>    grok {</span></span>
<span class="line"><span>        match =&gt; {</span></span>
<span class="line"><span>            &quot;message&quot; =&gt; [</span></span>
<span class="line"><span>                &quot;%{TIMESTAMP_ISO8601:timestamp}%{SPACE}\|%{SPACE}%{LOGLEVEL:level}%{SPACE}%{NUMBER:pid:int}%{SPACE}\|%{SPACE}%{DATA:thread_name}%{SPACE}\[TID:%{DATA:tid}\]%{SPACE}%{DATA:logger}%{SPACE}\-%{SPACE}\[%{DATA:method},%{NUMBER:line:int}\]%{SPACE}\|%{SPACE}%{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        overwrite =&gt; [&quot;message&quot;]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        strip =&gt; [&quot;tid&quot;, &quot;logger&quot;]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if ![pid] or [pid] =~ /^[^0-9]+$/ {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;pid&quot; =&gt; &quot;0&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![thread_name] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;thread_name&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }  </span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![tid] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;tid&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![method] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;method&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![line] or [line] =~ /^[^0-9]+$/ {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;line&quot; =&gt; &quot;0&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![logger] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;logger&quot; =&gt; &quot;unknown&quot; } </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        convert =&gt; {</span></span>
<span class="line"><span>            &quot;pid&quot; =&gt; &quot;integer&quot;</span></span>
<span class="line"><span>            &quot;line&quot; =&gt; &quot;integer&quot;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    date {</span></span>
<span class="line"><span>        match =&gt; [ &quot;timestamp&quot;, &quot;yyyy-MM-dd HH:mm:ss.SSS&quot; ]</span></span>
<span class="line"><span>        target =&gt; &quot;@timestamp&quot;</span></span>
<span class="line"><span>        timezone =&gt; &quot;Asia/Shanghai&quot;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    json {</span></span>
<span class="line"><span>        source =&gt; &quot;msg&quot;</span></span>
<span class="line"><span>        target =&gt; &quot;parsed_msg&quot;</span></span>
<span class="line"><span>        tag_on_failure =&gt; [ &quot;_not_json&quot; ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if &quot;_not_json&quot; not in [tags] {</span></span>
<span class="line"><span>        ruby {</span></span>
<span class="line"><span>            code =&gt; &#39;</span></span>
<span class="line"><span>                def mask_if_ip(str)</span></span>
<span class="line"><span>                    if str.match?(/\b(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/)</span></span>
<span class="line"><span>                        return &quot;***.***.***.***&quot;</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                    nil</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                def mask_if_idcard(str)</span></span>
<span class="line"><span>                    return nil unless str.is_a?(String)</span></span>
<span class="line"><span>                    return nil if str.empty?</span></span>
<span class="line"><span>                    if str.length == 18 &amp;&amp; str.match?(/\A\d{17}[\dXx]\z/i)</span></span>
<span class="line"><span>                        return str.gsub(/(\d{6})\d{8}(\d{4})/, &quot;\\1********\\2&quot;)</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                    nil</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                def mask_if_email(str)</span></span>
<span class="line"><span>                    if str.include?(&quot;@&quot;) &amp;&amp; str.match?(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)</span></span>
<span class="line"><span>                        parts = str.split(&quot;@&quot;, 2)</span></span>
<span class="line"><span>                        local = parts[0]</span></span>
<span class="line"><span>                        domain = parts[1]</span></span>
<span class="line"><span>                        masked_local = (local.length &lt;= 3) ? local + &quot;****&quot; : local[0,3] + &quot;****&quot;</span></span>
<span class="line"><span>                        return masked_local + &quot;@&quot; + domain</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                    nil</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                def mask_if_phone(str)</span></span>
<span class="line"><span>                    return nil unless str.is_a?(String)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    if str.match?(/\A1[3-9]\d{9}\z/)</span></span>
<span class="line"><span>                        return str[0,3] + &quot;****&quot; + str[-4..-1]</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                    clean = str.gsub(/[\\s\\-\\(\\)]/, &quot;&quot;)</span></span>
<span class="line"><span>                    if clean.start_with?(&quot;+&quot;) &amp;&amp; clean.match?(/\A\+\d{7,15}\z/)</span></span>
<span class="line"><span>                        if clean =~ /^(\+\d{1,3})(\d+)$/</span></span>
<span class="line"><span>                            cc = $1</span></span>
<span class="line"><span>                            num = $2</span></span>
<span class="line"><span>                            if num.length &gt;= 7</span></span>
<span class="line"><span>                                return cc + num[0,3] + &quot;****&quot; + num[-4..-1]</span></span>
<span class="line"><span>                            elsif num.length &gt;= 4</span></span>
<span class="line"><span>                                return cc + num[0,2] + &quot;****&quot; + num[-2..-1]</span></span>
<span class="line"><span>                            else</span></span>
<span class="line"><span>                                return cc + (&quot;*&quot; * num.length)</span></span>
<span class="line"><span>                            end</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    elsif clean.match?(/\A\d{7,15}\z/)</span></span>
<span class="line"><span>                        if clean.length &gt;= 7</span></span>
<span class="line"><span>                            return clean[0,3] + &quot;****&quot; + clean[-4..-1]</span></span>
<span class="line"><span>                        elsif clean.length &gt;= 4</span></span>
<span class="line"><span>                            return clean[0,2] + &quot;****&quot; + clean[-2..-1]</span></span>
<span class="line"><span>                        else</span></span>
<span class="line"><span>                            return &quot;*&quot; * clean.length</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                    nil</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                def mask_if_bankcard(str)</span></span>
<span class="line"><span>                    if str.match?(/^\d{13,19}$/)</span></span>
<span class="line"><span>                        len = str.length</span></span>
<span class="line"><span>                        if len &gt;= 10</span></span>
<span class="line"><span>                            return str[0,6] + &quot;********&quot; + str[-4..-1]</span></span>
<span class="line"><span>                        else</span></span>
<span class="line"><span>                            return &quot;*&quot; * len</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                    nil</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                def mask_if_creditcode(str)</span></span>
<span class="line"><span>                    if str.is_a?(String) &amp;&amp; str.length == 18 &amp;&amp; str.match?(/^[0-9A-HJ-NPQRTUWXY]{2}[0-9]{6}[0-9A-HJ-NPQRTUWXY]{10}$/)</span></span>
<span class="line"><span>                        return str[0,6] + &quot;********&quot; + str[-2..-1]</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                    nil</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                def deep_mask(obj)</span></span>
<span class="line"><span>                    case obj</span></span>
<span class="line"><span>                    when Hash</span></span>
<span class="line"><span>                        obj.each { |k, v| obj[k] = deep_mask(v) }</span></span>
<span class="line"><span>                    when Array</span></span>
<span class="line"><span>                        obj.map! { |v| deep_mask(v) }</span></span>
<span class="line"><span>                    when String</span></span>
<span class="line"><span>                        trimmed = obj.to_s.strip</span></span>
<span class="line"><span>                        if (trimmed.start_with?(&quot;{&quot;) &amp;&amp; trimmed.end_with?(&quot;}&quot;)) || (trimmed.start_with?(&quot;[&quot;) &amp;&amp; trimmed.end_with?(&quot;]&quot;))</span></span>
<span class="line"><span>                            begin</span></span>
<span class="line"><span>                                parsed_json = JSON.parse(trimmed)</span></span>
<span class="line"><span>                                masked_json = deep_mask(parsed_json)</span></span>
<span class="line"><span>                                JSON.generate(masked_json)</span></span>
<span class="line"><span>                            rescue =&gt; e</span></span>
<span class="line"><span>                                event.set(&quot;debug_json_parse_error&quot;, &quot;Failed to parse: #{trimmed.inspect} | Error: #{e.class}: #{e.message}&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                                mask_if_ip(trimmed) ||</span></span>
<span class="line"><span>                                mask_if_idcard(trimmed) ||</span></span>
<span class="line"><span>                                mask_if_email(trimmed) ||</span></span>
<span class="line"><span>                                mask_if_phone(trimmed) ||</span></span>
<span class="line"><span>                                mask_if_bankcard(trimmed) ||</span></span>
<span class="line"><span>                                mask_if_creditcode(trimmed) ||</span></span>
<span class="line"><span>                                obj</span></span>
<span class="line"><span>                            end</span></span>
<span class="line"><span>                        else</span></span>
<span class="line"><span>                            mask_if_ip(trimmed) ||</span></span>
<span class="line"><span>                            mask_if_idcard(trimmed) ||</span></span>
<span class="line"><span>                            mask_if_email(trimmed) ||</span></span>
<span class="line"><span>                            mask_if_phone(trimmed) ||</span></span>
<span class="line"><span>                            mask_if_bankcard(trimmed) ||</span></span>
<span class="line"><span>                            mask_if_creditcode(trimmed) ||</span></span>
<span class="line"><span>                            obj</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    else</span></span>
<span class="line"><span>                        obj</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                parsed = event.get(&quot;parsed_msg&quot;)</span></span>
<span class="line"><span>                if parsed</span></span>
<span class="line"><span>                    event.set(&quot;parsed_msg&quot;, deep_mask(parsed))</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span>            &#39;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    } </span></span>
<span class="line"><span>    else {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            gsub =&gt; [</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;\\b(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b&quot;, &quot;***.***.***.***&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;(\\d{3})\\d{4}(\\d{4})&quot;, &quot;\\1****\\2&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;([a-zA-Z0-9])([a-zA-Z0-9._%+-]*)@([a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})&quot;, &quot;\\1****@\\3&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;(\\d{6})\\d{8}(\\d{4})&quot;, &quot;\\1********\\2&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;(\\d{6})\\d{6,10}(\\d{4})&quot;, &quot;\\1********\\2&quot;,</span></span>
<span class="line"><span>                &quot;msg&quot;, &quot;([0-9A-HJ-NPQRTUWXY]{6})[0-9A-HJ-NPQRTUWXY]{10}([0-9A-HJ-NPQRTUWXY]{2})&quot;, &quot;\\1**********\\2&quot;</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ruby {</span></span>
<span class="line"><span>        code =&gt; &#39;</span></span>
<span class="line"><span>            event.set(&quot;msg&quot;, event.get(&quot;parsed_msg&quot;).to_json)</span></span>
<span class="line"><span>        &#39;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        remove_tag =&gt; [ &quot;_not_json&quot;, &quot;_outputJson_not_json&quot; ]</span></span>
<span class="line"><span>        remove_field =&gt; [ &quot;timestamp&quot;, &quot;message&quot;, &quot;parsed_msg&quot;, &quot;event&quot;, &quot;score&quot;, &quot;tags&quot;, &quot;host&quot;, &quot;agent&quot;, &quot;ecs&quot;, &quot;input&quot;, &quot;log&quot; ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>    elasticsearch {</span></span>
<span class="line"><span>        hosts =&gt; [&quot;http://elasticsearch:9200&quot;]</span></span>
<span class="line"><span>        index =&gt; &quot;app-logs-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    stdout {</span></span>
<span class="line"><span>        codec =&gt; rubydebug</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3ï¸âƒ£-å–æ¶ˆå¯¹-json-ç»“æ„çš„è¯†åˆ«-æ”¯æŒä»»æ„å†…å®¹æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-å–æ¶ˆå¯¹-json-ç»“æ„çš„è¯†åˆ«-æ”¯æŒä»»æ„å†…å®¹æ–¹æ¡ˆ"><span>3ï¸âƒ£ å–æ¶ˆå¯¹ JSON ç»“æ„çš„è¯†åˆ«ï¼Œæ”¯æŒä»»æ„å†…å®¹æ–¹æ¡ˆ</span></a></h4><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span>input {</span></span>
<span class="line"><span>    beats {</span></span>
<span class="line"><span>        port =&gt; 5044</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>filter {</span></span>
<span class="line"><span>    grok {</span></span>
<span class="line"><span>        match =&gt; {</span></span>
<span class="line"><span>            &quot;message&quot; =&gt; [</span></span>
<span class="line"><span>                &quot;%{TIMESTAMP_ISO8601:timestamp}%{SPACE}\|%{SPACE}%{LOGLEVEL:level}%{SPACE}%{NUMBER:pid:int}%{SPACE}\|%{SPACE}%{DATA:thread_name}%{SPACE}\[TID:%{DATA:tid}\]%{SPACE}%{DATA:logger}%{SPACE}\-%{SPACE}\[%{DATA:method},%{NUMBER:line:int}\]%{SPACE}\|%{SPACE}%{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span>            ]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        overwrite =&gt; [&quot;message&quot;]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        strip =&gt; [&quot;tid&quot;, &quot;logger&quot;]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if ![pid] or [pid] =~ /^[^0-9]+$/ {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;pid&quot; =&gt; &quot;0&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![thread_name] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;thread_name&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }  </span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![tid] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;tid&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![method] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;method&quot; =&gt; &quot;unknown&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![line] or [line] =~ /^[^0-9]+$/ {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;line&quot; =&gt; &quot;0&quot; }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![logger] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; { &quot;logger&quot; =&gt; &quot;unknown&quot; } </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        convert =&gt; {</span></span>
<span class="line"><span>            &quot;pid&quot; =&gt; &quot;integer&quot;</span></span>
<span class="line"><span>            &quot;line&quot; =&gt; &quot;integer&quot;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    date {</span></span>
<span class="line"><span>        match =&gt; [ &quot;timestamp&quot;, &quot;yyyy-MM-dd HH:mm:ss.SSS&quot; ]</span></span>
<span class="line"><span>        target =&gt; &quot;@timestamp&quot;</span></span>
<span class="line"><span>        timezone =&gt; &quot;Asia/Shanghai&quot;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if [msg] =~ /^{/ {</span></span>
<span class="line"><span>        json {</span></span>
<span class="line"><span>            source =&gt; &quot;msg&quot;</span></span>
<span class="line"><span>            target =&gt; &quot;parsed_msg&quot;</span></span>
<span class="line"><span>            tag_on_failure =&gt; [ &quot;_not_json&quot; ]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span></span></span>
<span class="line"><span>    ruby {</span></span>
<span class="line"><span>        code =&gt; &#39;</span></span>
<span class="line"><span>            def mask_text(text)</span></span>
<span class="line"><span>                return text unless text.is_a?(String)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text = text.gsub(/\b(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/, &quot;***.***.***.***&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text = text.gsub(/(1[3-9]\d)(\d{4})(\d{4})/, &quot;\\1****\\3&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text = text.gsub(/\+(\d{1,3})[-.]?(\d{3,6})(\d{2,4})(\d{2,4})\b/) { &quot;+#{$1}#{$2}****#{$4}&quot; }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text = text.gsub(/(\d{6})\d{8}(\d{4})/, &quot;\\1********\\2&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text = text.gsub(/([a-zA-Z0-9])([a-zA-Z0-9._%+-]*)@([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/, &quot;\\1****@\\3&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text = text.gsub(/(\d{6})\d{4,10}(\d{4})/, &quot;\\1********\\2&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text = text.gsub(/([0-9A-HJ-NPQRTUWXY]{6})[0-9A-HJ-NPQRTUWXY]{10}([0-9A-HJ-NPQRTUWXY]{2})/, &quot;\\1**********\\2&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text</span></span>
<span class="line"><span>            end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            def deep_mask(obj)</span></span>
<span class="line"><span>                case obj</span></span>
<span class="line"><span>                when Hash</span></span>
<span class="line"><span>                    obj.transform_values { |v| deep_mask(v) }</span></span>
<span class="line"><span>                when Array</span></span>
<span class="line"><span>                    obj.map { |v| deep_mask(v) }</span></span>
<span class="line"><span>                when String</span></span>
<span class="line"><span>                    s = obj.strip</span></span>
<span class="line"><span>                    if (s.start_with?(&quot;{&quot;) &amp;&amp; s.end_with?(&quot;}&quot;)) || (s.start_with?(&quot;[&quot;) &amp;&amp; s.end_with?(&quot;]&quot;))</span></span>
<span class="line"><span>                        begin</span></span>
<span class="line"><span>                            parsed_inner = JSON.parse(s)</span></span>
<span class="line"><span>                            masked_inner = deep_mask(parsed_inner)</span></span>
<span class="line"><span>                            JSON.generate(masked_inner)</span></span>
<span class="line"><span>                        rescue</span></span>
<span class="line"><span>                            mask_text(s) || s</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    else</span></span>
<span class="line"><span>                        mask_text(s) || s</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                else</span></span>
<span class="line"><span>                    obj</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span>            end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            original_msg = event.get(&quot;msg&quot;)</span></span>
<span class="line"><span>            if original_msg</span></span>
<span class="line"><span>                masked_msg = mask_text(original_msg.to_s)</span></span>
<span class="line"><span>                event.set(&quot;msg&quot;, masked_msg)</span></span>
<span class="line"><span>            end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            parsed = event.get(&quot;parsed_msg&quot;)</span></span>
<span class="line"><span>            if parsed.is_a?(Hash) || parsed.is_a?(Array)</span></span>
<span class="line"><span>                begin</span></span>
<span class="line"><span>                    masked_parsed = deep_mask(parsed)</span></span>
<span class="line"><span>                    event.set(&quot;parsed_msg&quot;, masked_parsed)</span></span>
<span class="line"><span>                    event.set(&quot;msg&quot;, JSON.generate(masked_parsed))</span></span>
<span class="line"><span>                rescue =&gt; e</span></span>
<span class="line"><span>                    event.set(&quot;debug_ruby_error&quot;, &quot;Failed to re-serialize parsed_msg: #{e.message}&quot;)</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span>            end</span></span>
<span class="line"><span>        &#39;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        remove_tag =&gt; [ &quot;_not_json&quot; ]</span></span>
<span class="line"><span>        remove_field =&gt; [ &quot;timestamp&quot;, &quot;message&quot;, &quot;parsed_msg&quot;, &quot;event&quot;, &quot;score&quot;, &quot;tags&quot;, &quot;host&quot;, &quot;agent&quot;, &quot;ecs&quot;, &quot;input&quot;, &quot;log&quot; ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>    elasticsearch {</span></span>
<span class="line"><span>        hosts =&gt; [&quot;http://elasticsearch:9200&quot;]</span></span>
<span class="line"><span>        index =&gt; &quot;app-logs-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    stdout {</span></span>
<span class="line"><span>        codec =&gt; rubydebug</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4ï¸âƒ£-æœ€ç»ˆæ–¹æ¡ˆ-å«æ³¨é‡Šè¯´æ˜-åŒæ—¶æ”¯æŒå¤šç§æ—¥å¿—æ ¼å¼ã€ä»»æ„å†…å®¹æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_4ï¸âƒ£-æœ€ç»ˆæ–¹æ¡ˆ-å«æ³¨é‡Šè¯´æ˜-åŒæ—¶æ”¯æŒå¤šç§æ—¥å¿—æ ¼å¼ã€ä»»æ„å†…å®¹æ–¹æ¡ˆ"><span>4ï¸âƒ£ ï¼ˆæœ€ç»ˆæ–¹æ¡ˆï¼Œå«æ³¨é‡Šè¯´æ˜ï¼‰åŒæ—¶æ”¯æŒå¤šç§æ—¥å¿—æ ¼å¼ã€ä»»æ„å†…å®¹æ–¹æ¡ˆ</span></a></h4><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-conf"><span class="line"><span># =================================</span></span>
<span class="line"><span># INPUT: æ¥å— Filebeat å‘é€è¿‡æ¥çš„æ—¥å¿—æ•°æ®</span></span>
<span class="line"><span># =================================</span></span>
<span class="line"><span>input {</span></span>
<span class="line"><span>    beats {</span></span>
<span class="line"><span>        port =&gt; 5044    # ç›‘å¬ 5044 ç«¯å£ï¼Œæ¥å—æ¥è‡ª Filebeat çš„æ—¥å¿—æ•°æ®</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># =================================</span></span>
<span class="line"><span># FILTER: æ—¥å¿—è§£æã€æ ‡å‡†åŒ–ã€æ¸…æ´—ã€è„±æ•ç­‰å¤„ç†</span></span>
<span class="line"><span># =================================</span></span>
<span class="line"><span>filter {</span></span>
<span class="line"><span>    # åˆå§‹æ ‡è®°ï¼šå‡è®¾æ‰€æœ‰æ—¥å¿—æ ¼å¼éƒ½ä¸åŒ¹é…ï¼Œåç»­é€šè¿‡ grok æˆåŠŸåˆ™ç§»é™¤æ­¤æ ‡ç­¾</span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        add_tag =&gt; [&quot;_log_format_unmatched&quot;]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # å°è¯•è§£ææ—¥å¿—æ ¼å¼ 1</span></span>
<span class="line"><span>    #</span></span>
<span class="line"><span>    # æ—¥å¿—æ ¼å¼1ï¼š%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}} | ${LOG_LEVEL_PATTERN:-%5p} ${PID:- } | %thread [%tid] %-40.40logger{39} - [%method,%line] | %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}</span></span>
<span class="line"><span>    # æ ‡å‡† Javaæ—¥å¿—ï¼Œå« PIDã€TIDã€çº¿ç¨‹åã€ç±»åã€æ–¹æ³•åã€è¡Œå·ç­‰ä¿¡æ¯</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    if &quot;_log_format_unmatched&quot; in [tags] {</span></span>
<span class="line"><span>        grok {</span></span>
<span class="line"><span>            # grok æ ¼å¼åŒ¹é…è§£æ</span></span>
<span class="line"><span>            match =&gt; {</span></span>
<span class="line"><span>                &quot;message&quot; =&gt; &quot;%{TIMESTAMP_ISO8601:timestamp}%{SPACE}\|%{SPACE}%{LOGLEVEL:level}%{SPACE}%{NUMBER:pid:int}%{SPACE}\|%{SPACE}%{DATA:thread_name}%{SPACE}\[TID:%{DATA:tid}\]%{SPACE}%{DATA:logger}%{SPACE}\-%{SPACE}\[%{DATA:method},%{NUMBER:line:int}\]%{SPACE}\|%{SPACE}%{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            tag_on_failure =&gt; [&quot;_grok_fmt1_fail&quot;]       # åŒ¹é…å¤±è´¥æ—¶æ‰“ä¸Šå¤±è´¥æ ‡ç­¾</span></span>
<span class="line"><span>            remove_tag =&gt; [&quot;_log_format_unmatched&quot;]     # åŒ¹é…æˆåŠŸåˆ™ç§»é™¤â€œæœªåŒ¹é…â€æ ‡ç­¾</span></span>
<span class="line"><span>            add_tag =&gt; [&quot;_format_type_1&quot;]               # æ ‡è®°æˆåŠŸåŒ¹é…çš„æ ¼å¼ï¼šæ ¼å¼1</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # å°è¯•è§£ææ—¥å¿—æ ¼å¼ 2</span></span>
<span class="line"><span>    #</span></span>
<span class="line"><span>    # æ—¥å¿—æ ¼å¼2ï¼š%d{yyyy-MM-dd HH:mm:ss.SSS} [%-5level] from %logger{36} in %thread - %msg%n</span></span>
<span class="line"><span>    # ç®€åŒ–æ—¥å¿—ï¼Œæ—  PID/TID/æ–¹æ³•è¡Œå·ç­‰ï¼Œå« â€œfrom ... in ...â€ ç»“æ„</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    if &quot;_log_format_unmatched&quot; in [tags] {</span></span>
<span class="line"><span>        grok {</span></span>
<span class="line"><span>            match =&gt; {</span></span>
<span class="line"><span>                &quot;message&quot; =&gt; &quot;%{TIMESTAMP_ISO8601:timestamp}%{SPACE}\[%{LOGLEVEL:level}%{SPACE}\]%{SPACE}from%{SPACE}%{JAVACLASS:logger}%{SPACE}in%{SPACE}%{DATA:thread_name}%{SPACE}-%{SPACE}%{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            tag_on_failure =&gt; [&quot;_grok_fmt2_fail&quot;]</span></span>
<span class="line"><span>            remove_tag =&gt; [&quot;_log_format_unmatched&quot;]</span></span>
<span class="line"><span>            add_tag =&gt; [&quot;_format_type_2&quot;]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # å°è¯•è§£ææ—¥å¿—æ ¼å¼ 3</span></span>
<span class="line"><span>    #</span></span>
<span class="line"><span>    # æ—¥å¿—æ ¼å¼3ï¼š%d{yyyy-MM-dd HH:mm:ss.SSS} [%-5level] [%thread] [%logger{50}] %file:%line - %msg%n</span></span>
<span class="line"><span>    # å« [çº¿ç¨‹][ç±»] class:line ç»“æ„</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    if &quot;_log_format_unmatched&quot; in [tags] {</span></span>
<span class="line"><span>        grok {</span></span>
<span class="line"><span>            match =&gt; {</span></span>
<span class="line"><span>                &quot;message&quot; =&gt; &quot;%{TIMESTAMP_ISO8601:timestamp}%{SPACE}\[%{LOGLEVEL:level} %{SPACE}\]%{SPACE}\[%{DATA:thread_name}\]%{SPACE}\[%{JAVACLASS:logger}\]%{SPACE}%{DATA:class}:%{NUMBER:line:int}%{SPACE}-%{SPACE}%{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            tag_on_failure =&gt; [&quot;_grok_fmt3_fail&quot;]</span></span>
<span class="line"><span>            remove_tag =&gt; [&quot;_log_format_unmatched&quot;]</span></span>
<span class="line"><span>            add_tag =&gt; [&quot;_format_type_3&quot;]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # å°è¯•è§£ææ—¥å¿—æ ¼å¼ 4</span></span>
<span class="line"><span>    #</span></span>
<span class="line"><span>    # æ—¥å¿—æ ¼å¼4ï¼š%d{yyyy-MM-dd HH:mm:ss.SSS} [%-5level] [%thread] %logger{20} - [%method,%line] - %msg%n</span></span>
<span class="line"><span>    # å« [çº¿ç¨‹]ç±» - [æ–¹æ³•,è¡Œå·] ç»“æ„</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    if &quot;_log_format_unmatched&quot; in [tags] {</span></span>
<span class="line"><span>        grok {</span></span>
<span class="line"><span>            match =&gt; {</span></span>
<span class="line"><span>                &quot;message&quot; =&gt; &quot;%{TIMESTAMP_ISO8601:timestamp}%{SPACE}\[%{LOGLEVEL:level} %{SPACE}\]%{SPACE}\[%{DATA:thread_name}\]%{SPACE}%{JAVACLASS:logger}%{SPACE}-%{SPACE}\[%{DATA:method},%{NUMBER:line:int}\]%{SPACE}-%{SPACE}%{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            tag_on_failure =&gt; [&quot;_grok_fmt4_fail&quot;]</span></span>
<span class="line"><span>            remove_tag =&gt; [&quot;_log_format_unmatched&quot;]</span></span>
<span class="line"><span>            add_tag =&gt; [&quot;_format_type_4&quot;]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # å°è¯•è§£ææ—¥å¿—æ ¼å¼ 5</span></span>
<span class="line"><span>    #</span></span>
<span class="line"><span>    # æ—¥å¿—æ ¼å¼5ï¼š%d{yyyy-MM-dd HH:mm:ss.SSS} [%-5level] [%logger{50}] %file:%line - %msg%n</span></span>
<span class="line"><span>    # æ— çº¿ç¨‹åï¼Œåªæœ‰ [ç±»] class:line ç»“æ„</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    if &quot;_log_format_unmatched&quot; in [tags] {</span></span>
<span class="line"><span>        grok {</span></span>
<span class="line"><span>            match =&gt; {</span></span>
<span class="line"><span>                &quot;message&quot; =&gt; &quot;%{TIMESTAMP_ISO8601:timestamp}%{SPACE}\[%{LOGLEVEL:level} %{SPACE}\]%{SPACE}\[%{JAVACLASS:logger}\]%{SPACE}%{DATA:class}:%{NUMBER:line:int}%{SPACE}-%{SPACE}%{GREEDYDATA:msg}&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            tag_on_failure =&gt; [&quot;_grok_fmt5_fail&quot;]</span></span>
<span class="line"><span>            remove_tag =&gt; [&quot;_log_format_unmatched&quot;]</span></span>
<span class="line"><span>            add_tag =&gt; [&quot;_format_type_5&quot;]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # æœ€ç»ˆå…œåº•ï¼šå¦‚æœä»¥ä¸Šæ‰€æœ‰æ—¥å¿—æ ¼å¼éƒ½æ²¡æœ‰åŒ¹é…æˆåŠŸï¼Œåˆ™ä½¿ç”¨é»˜è®¤å­—æ®µè¿›è¡Œå¡«å……</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    if &quot;_log_format_unmatched&quot; in [tags] {</span></span>
<span class="line"><span>        mutate {</span></span>
<span class="line"><span>            add_field =&gt; {</span></span>
<span class="line"><span>                &quot;msg&quot; =&gt; &quot;%{message}&quot;           # åŸå§‹æ¶ˆæ¯ä½œä¸º msg</span></span>
<span class="line"><span>                &quot;logger&quot; =&gt; &quot;unknown&quot;</span></span>
<span class="line"><span>                &quot;thread_name&quot; =&gt; &quot;unknown&quot;</span></span>
<span class="line"><span>                &quot;method&quot; =&gt; &quot;unknown&quot;</span></span>
<span class="line"><span>                &quot;class&quot; =&gt; &quot;unknown&quot;</span></span>
<span class="line"><span>                &quot;line&quot; =&gt; &quot;0&quot;</span></span>
<span class="line"><span>                &quot;pid&quot; =&gt; &quot;0&quot;</span></span>
<span class="line"><span>                &quot;tid&quot; =&gt; &quot;unknown&quot;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>            add_tag =&gt; [&quot;_format_type_unknown&quot;]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # å­—æ®µæ ‡å‡†åŒ–ï¼šç¡®ä¿å…³é”®å­—æ®µå­˜åœ¨ä¸”åˆæ³•</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        strip =&gt; [&quot;tid&quot;, &quot;logger&quot;]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # pid å¿…é¡»æ˜¯æ•°å­—ï¼Œå¦åˆ™è®¾ä¸º 0</span></span>
<span class="line"><span>    if ![pid] or [pid] == &quot;&quot; or [pid] =~ /^[^0-9]+$/ {</span></span>
<span class="line"><span>        mutate { </span></span>
<span class="line"><span>            remove_field =&gt; [ &quot;pid&quot; ]</span></span>
<span class="line"><span>            add_field =&gt; { &quot;pid&quot; =&gt; &quot;0&quot; } </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # thread_name ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™è®¾ä¸º &quot;unknown&quot;</span></span>
<span class="line"><span>    if ![thread_name] or [thread_name] == &quot;&quot; {</span></span>
<span class="line"><span>        mutate { </span></span>
<span class="line"><span>            remove_field =&gt; [ &quot;thread_name&quot; ]</span></span>
<span class="line"><span>            add_field =&gt; { &quot;thread_name&quot; =&gt; &quot;unknown&quot; } </span></span>
<span class="line"><span>        }  </span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![tid] or [tid] == &quot;&quot; {</span></span>
<span class="line"><span>        mutate { </span></span>
<span class="line"><span>            remove_field =&gt; [ &quot;tid&quot; ]</span></span>
<span class="line"><span>            add_field =&gt; { &quot;tid&quot; =&gt; &quot;unknown&quot; } </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![method] or [method] == &quot;&quot; {</span></span>
<span class="line"><span>        mutate { </span></span>
<span class="line"><span>            remove_field =&gt; [ &quot;method&quot; ]</span></span>
<span class="line"><span>            add_field =&gt; { &quot;method&quot; =&gt; &quot;unknown&quot; } </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![line] or [line] == &quot;&quot; or [line] =~ /^[^0-9]+$/ {</span></span>
<span class="line"><span>        mutate { </span></span>
<span class="line"><span>            remove_field =&gt; [ &quot;line&quot; ]</span></span>
<span class="line"><span>            add_field =&gt; { &quot;line&quot; =&gt; &quot;0&quot; } </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    if ![logger] or [logger] == &quot;&quot; {</span></span>
<span class="line"><span>        mutate { </span></span>
<span class="line"><span>            remove_field =&gt; [ &quot;logger&quot; ]</span></span>
<span class="line"><span>            add_field =&gt; { &quot;logger&quot; =&gt; &quot;unknown&quot; } </span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # æ—¶é—´è§£æï¼šå°†æ—¥å¿—ä¸­çš„ timestamp å­—æ®µè½¬æ¢ä¸º @timestamp æ ‡å‡†æ—¶é—´å­—æ®µ</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    date {</span></span>
<span class="line"><span>        match =&gt; [ &quot;timestamp&quot;, &quot;yyyy-MM-dd HH:mm:ss.SSS&quot; ]     # æ”¯æŒæ¯«ç§’çº§åˆ«æ—¶é—´</span></span>
<span class="line"><span>        target =&gt; &quot;@timestamp&quot;</span></span>
<span class="line"><span>        timezone =&gt; &quot;Asia/Shanghai&quot;                             # è®¾ç½®æ—¶åŒºä¸ºä¸­å›½æ—¶åŒº</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # JSONè‡ªåŠ¨è§£æï¼šå¦‚æœ msg å­—æ®µæ˜¯ JSON æ ¼å¼ï¼Œåˆ™è§£æä¸ºç»“æ„åŒ–æ•°æ®</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    if [msg] =~ /^(\{|\[)/ {</span></span>
<span class="line"><span>        json {</span></span>
<span class="line"><span>            source =&gt; &quot;msg&quot;                         # ä» msg å­—æ®µè¯»å–</span></span>
<span class="line"><span>            target =&gt; &quot;parsed_msg&quot;                  # è§£æç»“æœå­˜æ”¾åˆ° parsed_msg å­—æ®µ</span></span>
<span class="line"><span>            tag_on_failure =&gt; [ &quot;_not_json&quot; ]       # å¦‚æœè§£æå¤±è´¥ï¼Œæ‰“ä¸Šå¤±è´¥æ ‡ç­¾</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†ï¼ˆIPã€æ‰‹æœºå·ã€èº«ä»½è¯ã€é“¶è¡Œå¡å·ã€ä¼ä¸šä¿¡ç”¨ä»£ç ã€é‚®ç®±ç­‰ï¼‰</span></span>
<span class="line"><span>    # ä½¿ç”¨ Ruby è„šæœ¬è¿›è¡Œæ·±åº¦é€’å½’å¤„ç†ï¼Œå¤„ç†åŸå§‹ msg å­—æ®µå’Œè§£æåçš„ parsed_msg å­—æ®µ</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    ruby {</span></span>
<span class="line"><span>        code =&gt; &#39;</span></span>
<span class="line"><span>            # å•å±‚æ–‡æœ¬è„±æ•å‡½æ•°</span></span>
<span class="line"><span>            def mask_text(text)</span></span>
<span class="line"><span>                # å¯¹å‡½æ•°çš„è¾“å…¥å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸æ˜¯ String å­—ç¬¦ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸è¿›è¡Œå‡½æ•°å¤„ç†</span></span>
<span class="line"><span>                return text unless text.is_a?(String)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                # è„±æ• IP åœ°å€ï¼šæ ¼å¼ 127.0.0.1 ==&gt; ***.***.***.***</span></span>
<span class="line"><span>                text = text.gsub(/\b(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/, &quot;***.***.***.***&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                # è„±æ•å›½å†…æ‰‹æœºå·ï¼šæ ¼å¼ 13812345678 ==&gt; 138****5678</span></span>
<span class="line"><span>                text = text.gsub(/(1[3-9]\d)(\d{4})(\d{4})/, &quot;\\1****\\3&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                # è„±æ•å›½é™…æ‰‹æœºå·ï¼šæ ¼å¼ +8613812345678 æˆ– +86-13812345678 ==&gt; +86****5678</span></span>
<span class="line"><span>                text = text.gsub(/\+(\d{1,3})[-.]?(\d{3,6})(\d{2,4})(\d{2,4})\b/) { &quot;+#{$1}#{$2}****#{$4}&quot; }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                # è„±æ•èº«ä»½è¯å·ï¼šæ ¼å¼ 110101199001011234 ==&gt; 110101********1234</span></span>
<span class="line"><span>                text = text.gsub(/(\d{6})\d{8}(\d{4})/, &quot;\\1********\\2&quot;)</span></span>
<span class="line"><span>                </span></span>
<span class="line"><span>                # è„±æ•é‚®ç®±åœ°å€ï¼šæ ¼å¼ hamster@niu.com ==&gt; ham****@niu.com</span></span>
<span class="line"><span>                text = text.gsub(/([a-zA-Z0-9])([a-zA-Z0-9._%+-]*)@([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/, &quot;\\1****@\\3&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                # è„±æ•é“¶è¡Œå¡å·ï¼šæ ¼å¼ 6222021234567890123 ==&gt; 622202**********0123</span></span>
<span class="line"><span>                text = text.gsub(/(\d{6})\d{4,10}(\d{4})/, &quot;\\1********\\2&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                # è„±æ•ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼šæ ¼å¼ 91330106563412345A ==&gt; 913301**********45A</span></span>
<span class="line"><span>                text = text.gsub(/([0-9A-HJ-NPQRTUWXY]{6})[0-9A-HJ-NPQRTUWXY]{10}([0-9A-HJ-NPQRTUWXY]{2})/, &quot;\\1**********\\2&quot;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>                text</span></span>
<span class="line"><span>            end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            # æ·±åº¦é€’å½’è„±æ•å‡½æ•°ï¼šæ”¯æŒåµŒå¥— JSON å¯¹è±¡/æ•°ç»„</span></span>
<span class="line"><span>            def deep_mask(obj)</span></span>
<span class="line"><span>                case obj</span></span>
<span class="line"><span>                # å½“å¯¹è±¡æ˜¯ Hash æ—¶ï¼Œé€’å½’å¤„ç†æ¯ä¸ªé”®å€¼å¯¹</span></span>
<span class="line"><span>                when Hash</span></span>
<span class="line"><span>                    obj.transform_values { |v| deep_mask(v) }</span></span>
<span class="line"><span>                # å½“å¯¹è±¡æ˜¯ Array æ—¶ï¼Œé€’å½’å¤„ç†æ¯ä¸ªå…ƒç´ </span></span>
<span class="line"><span>                when Array</span></span>
<span class="line"><span>                    obj.map { |v| deep_mask(v) }</span></span>
<span class="line"><span>                # å½“å¯¹è±¡æ˜¯ String æ—¶ï¼Œå…ˆå°è¯•è§£æä¸º JSONï¼Œå¦‚æœæˆåŠŸåˆ™é€’å½’å¤„ç†ï¼Œå¦åˆ™ç›´æ¥è„±æ•æ–‡æœ¬</span></span>
<span class="line"><span>                when String</span></span>
<span class="line"><span>                    s = obj.strip</span></span>
<span class="line"><span>                    # å¦‚æœå­—ç¬¦ä¸²æ˜¯ JSON æ ¼å¼ï¼Œåˆ™å°è¯•è§£æåè„±æ•å†åºåˆ—åŒ–å›å­—ç¬¦ä¸²</span></span>
<span class="line"><span>                    if (s.start_with?(&quot;{&quot;) &amp;&amp; s.end_with?(&quot;}&quot;)) || (s.start_with?(&quot;[&quot;) &amp;&amp; s.end_with?(&quot;]&quot;))</span></span>
<span class="line"><span>                        begin</span></span>
<span class="line"><span>                            parsed_inner = JSON.parse(s)</span></span>
<span class="line"><span>                            masked_inner = deep_mask(parsed_inner)</span></span>
<span class="line"><span>                            JSON.generate(masked_inner)</span></span>
<span class="line"><span>                        rescue</span></span>
<span class="line"><span>                            mask_text(s) || s</span></span>
<span class="line"><span>                        end</span></span>
<span class="line"><span>                    else</span></span>
<span class="line"><span>                        mask_text(s) || s</span></span>
<span class="line"><span>                    end</span></span>
<span class="line"><span>                else</span></span>
<span class="line"><span>                    obj</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span>            end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            # å¤„ç†åŸå§‹ msg å­—æ®µ</span></span>
<span class="line"><span>            original_msg = event.get(&quot;msg&quot;)</span></span>
<span class="line"><span>            if original_msg</span></span>
<span class="line"><span>                masked_msg = mask_text(original_msg.to_s)</span></span>
<span class="line"><span>                event.set(&quot;msg&quot;, masked_msg)</span></span>
<span class="line"><span>            end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>            # å¤„ç†è§£æåçš„ parsed_msg å­—æ®µ</span></span>
<span class="line"><span>            parsed = event.get(&quot;parsed_msg&quot;)</span></span>
<span class="line"><span>            if parsed.is_a?(Hash) || parsed.is_a?(Array)</span></span>
<span class="line"><span>                begin</span></span>
<span class="line"><span>                    masked_parsed = deep_mask(parsed)</span></span>
<span class="line"><span>                    event.set(&quot;parsed_msg&quot;, masked_parsed)</span></span>
<span class="line"><span>                    # å°†è„±æ•åçš„ç»“æ„é‡æ–°åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œè¦†ç›–åŸå§‹ msg å­—æ®µ</span></span>
<span class="line"><span>                    event.set(&quot;msg&quot;, JSON.generate(masked_parsed))</span></span>
<span class="line"><span>                rescue =&gt; e</span></span>
<span class="line"><span>                    event.set(&quot;debug_ruby_error&quot;, &quot;Failed to re-serialize parsed_msg: #{e.message}&quot;)</span></span>
<span class="line"><span>                end</span></span>
<span class="line"><span>            end</span></span>
<span class="line"><span>        &#39;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    # æ¸…ç†ä¸´æ—¶æ ‡ç­¾å’Œå­—æ®µ</span></span>
<span class="line"><span>    # =================================</span></span>
<span class="line"><span>    mutate {</span></span>
<span class="line"><span>        # ç§»é™¤æ‰€æœ‰ä¸­é—´å¤„ç†æ ‡ç­¾</span></span>
<span class="line"><span>        remove_tag =&gt; [ &quot;_not_json&quot;, &quot;_grok_fmt1_fail&quot;, &quot;_grok_fmt2_fail&quot;, &quot;_grok_fmt3_fail&quot;, &quot;_grok_fmt4_fail&quot;, &quot;_grok_fmt5_fail&quot; ]</span></span>
<span class="line"><span>        # ç§»é™¤ä¸éœ€è¦å­˜å‚¨åˆ° Elasticsearch çš„å­—æ®µï¼ˆèŠ‚çœç©ºé—´ã€é¿å…å†²çªï¼‰</span></span>
<span class="line"><span>        remove_field =&gt; [ </span></span>
<span class="line"><span>            &quot;timestamp&quot;,    # å·²è½¬ä¸º @timestamp</span></span>
<span class="line"><span>            &quot;message&quot;,      # åŸå§‹æ¶ˆæ¯ï¼Œå·²è§£æåˆ° msg å­—æ®µ</span></span>
<span class="line"><span>            &quot;parsed_msg&quot;,   # ä¸­é—´è§£æå­—æ®µï¼Œå·²è„±æ•è¦†ååˆå¹¶åˆ° msg å­—æ®µ</span></span>
<span class="line"><span>            &quot;event&quot;, &quot;score&quot;, &quot;tags&quot;, &quot;@metadata&quot;, &quot;host&quot;, &quot;agent&quot;, &quot;ecs&quot;, &quot;input&quot;, &quot;log&quot;   # Filebeat ç›¸å…³å…ƒæ•°æ®å­—æ®µ</span></span>
<span class="line"><span>        ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># =================================</span></span>
<span class="line"><span># OUTPUT: å°†å¤„ç†åçš„æ—¥å¿—æ•°æ®å‘é€åˆ° Elasticsearch å’Œæ§åˆ¶å°</span></span>
<span class="line"><span># =================================</span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>    elasticsearch {</span></span>
<span class="line"><span>        hosts =&gt; [&quot;http://elasticsearch:9200&quot;]</span></span>
<span class="line"><span>        index =&gt; &quot;app-logs-%{+YYYY.MM.dd}&quot;      # æŒ‰å¤©åˆ†ç´¢å¼•</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    # DUBUG: è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä¾¿äºè°ƒè¯•æŸ¥çœ‹ï¼ˆå¼€å‘/æµ‹è¯• ä½¿ç”¨ï¼‰</span></span>
<span class="line"><span>    stdout {</span></span>
<span class="line"><span>        codec =&gt; rubydebug</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å››ã€æœ€ç»ˆæ•ˆæœ" tabindex="-1"><a class="header-anchor" href="#å››ã€æœ€ç»ˆæ•ˆæœ"><span>å››ã€æœ€ç»ˆæ•ˆæœ</span></a></h3><figure><img src="https://cdn.jsdelivr.net/gh/witty-hamster/oss@master/202511/image-20251114132831315.png" alt="image-20251114132831315" tabindex="0" loading="lazy"><figcaption>image-20251114132831315</figcaption></figure><figure><img src="https://cdn.jsdelivr.net/gh/witty-hamster/oss@master/202511/image-20251114132831320.png" alt="image-20251114132831320" tabindex="0" loading="lazy"><figcaption>image-20251114132831320</figcaption></figure></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/posts/æ”¶é›†ç®±/åŸºäº ELK + Filebeat å®ç°æ—¥å¿—é‡‡é›†æ–¹æ¡ˆ.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">æœ€è¿‘æ›´æ–°</span><time class="vp-meta-info" datetime="2025-11-14T05:41:26.000Z" data-allow-mismatch>2025/11/14 05:41</time></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: cuiguodong_2012@163.com">guodong</span>,<!--]--><!--[--><span class="vp-meta-info" title="email: cuiguodong_2012@163.com">hamster</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/%E6%94%B6%E9%9B%86%E7%AE%B1/spring-cloud-gateway%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" aria-label="Spring Cloud Gateway æºç è°ƒè¯•ç¯å¢ƒæ­å»º"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><iconify-icon class="vp-icon" icon="cil:dog" sizing="height" height="1em"></iconify-icon>Spring Cloud Gateway æºç è°ƒè¯•ç¯å¢ƒæ­å»º</div></a><a class="route-link auto-link next" href="/posts/%E6%94%B6%E9%9B%86%E7%AE%B1/CompletableFuture%20%E7%B1%BB%E8%AF%A6%E8%A7%A3.html" aria-label="Java8 - CompletableFuture å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒå·¥å…·ç±»è¯¦è§£"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Java8 - CompletableFuture å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒå·¥å…·ç±»è¯¦è§£<iconify-icon class="vp-icon" icon="devicon:java-wordmark" sizing="height" height="1em"></iconify-icon></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">é»˜è®¤é¡µè„š</div><div class="vp-copyright">Copyright Â© 2025 Hamster </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DagONn1s.js" defer></script>
  </body>
</html>
